

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tensorflow.python.keras.layers.convolutional &mdash; MedSegPy 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../../../',
              VERSION:'0.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> MedSegPy
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorials/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules/index.html">API Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">MedSegPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
      <li>tensorflow.python.keras.layers.convolutional</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tensorflow.python.keras.layers.convolutional</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2015 The TensorFlow Authors. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ==============================================================================</span>
<span class="sd">&quot;&quot;&quot;Keras convolution layers and image transformation layers.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">tensorflow.python.eager</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.framework</span> <span class="kn">import</span> <span class="n">tensor_shape</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras</span> <span class="kn">import</span> <span class="n">activations</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras</span> <span class="kn">import</span> <span class="n">backend</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras</span> <span class="kn">import</span> <span class="n">constraints</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras</span> <span class="kn">import</span> <span class="n">initializers</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras</span> <span class="kn">import</span> <span class="n">regularizers</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.engine.base_layer</span> <span class="kn">import</span> <span class="n">Layer</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.engine.input_spec</span> <span class="kn">import</span> <span class="n">InputSpec</span>
<span class="c1"># imports for backwards namespace compatibility</span>
<span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.layers.pooling</span> <span class="kn">import</span> <span class="n">AveragePooling1D</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.layers.pooling</span> <span class="kn">import</span> <span class="n">AveragePooling2D</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.layers.pooling</span> <span class="kn">import</span> <span class="n">AveragePooling3D</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.layers.pooling</span> <span class="kn">import</span> <span class="n">MaxPooling1D</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.layers.pooling</span> <span class="kn">import</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.layers.pooling</span> <span class="kn">import</span> <span class="n">MaxPooling3D</span>
<span class="c1"># pylint: enable=unused-import</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.utils</span> <span class="kn">import</span> <span class="n">conv_utils</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.utils</span> <span class="kn">import</span> <span class="n">tf_utils</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.ops</span> <span class="kn">import</span> <span class="n">array_ops</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.ops</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.ops</span> <span class="kn">import</span> <span class="n">nn_ops</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.util.tf_export</span> <span class="kn">import</span> <span class="n">keras_export</span>
<span class="c1"># pylint: disable=g-classes-have-attributes</span>


<span class="k">class</span> <span class="nc">Conv</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Abstract N-D convolution layer (private, used as implementation base).</span>

<span class="sd">  This layer creates a convolution kernel that is convolved</span>
<span class="sd">  (actually cross-correlated) with the layer input to produce a tensor of</span>
<span class="sd">  outputs. If `use_bias` is True (and a `bias_initializer` is provided),</span>
<span class="sd">  a bias vector is created and added to the outputs. Finally, if</span>
<span class="sd">  `activation` is not `None`, it is applied to the outputs as well.</span>

<span class="sd">  Note: layer attributes cannot be modified after the layer has been called</span>
<span class="sd">  once (except the `trainable` attribute).</span>

<span class="sd">  Arguments:</span>
<span class="sd">    rank: An integer, the rank of the convolution, e.g. &quot;2&quot; for 2D convolution.</span>
<span class="sd">    filters: Integer, the dimensionality of the output space (i.e. the number</span>
<span class="sd">      of filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of n integers, specifying the</span>
<span class="sd">      length of the convolution window.</span>
<span class="sd">    strides: An integer or tuple/list of n integers,</span>
<span class="sd">      specifying the stride length of the convolution.</span>
<span class="sd">      Specifying any stride value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: One of `&quot;valid&quot;`,  `&quot;same&quot;`, or `&quot;causal&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, ..., channels)` while `channels_first` corresponds to</span>
<span class="sd">      inputs with shape `(batch_size, channels, ...)`.</span>
<span class="sd">    dilation_rate: An integer or tuple/list of n integers, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any `strides` value != 1.</span>
<span class="sd">    groups: A positive integer specifying the number of groups in which the</span>
<span class="sd">      input is split along the channel axis. Each group is convolved</span>
<span class="sd">      separately with `filters / groups` filters. The output is the</span>
<span class="sd">      concatenation of all the `groups` results along the channel axis.</span>
<span class="sd">      Input channels and `filters` must both be divisible by `groups`.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied.</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias.</span>
<span class="sd">    kernel_initializer: An initializer for the convolution kernel.</span>
<span class="sd">    bias_initializer: An initializer for the bias vector. If None, the default</span>
<span class="sd">      initializer will be used.</span>
<span class="sd">    kernel_regularizer: Optional regularizer for the convolution kernel.</span>
<span class="sd">    bias_regularizer: Optional regularizer for the bias vector.</span>
<span class="sd">    activity_regularizer: Optional regularizer function for the output.</span>
<span class="sd">    kernel_constraint: Optional projection function to be applied to the</span>
<span class="sd">        kernel after being updated by an `Optimizer` (e.g. used to implement</span>
<span class="sd">        norm constraints or value constraints for layer weights). The function</span>
<span class="sd">        must take as input the unprojected variable and must return the</span>
<span class="sd">        projected variable (which must have the same shape). Constraints are</span>
<span class="sd">        not safe to use when doing asynchronous distributed training.</span>
<span class="sd">    bias_constraint: Optional projection function to be applied to the</span>
<span class="sd">        bias after being updated by an `Optimizer`.</span>
<span class="sd">    trainable: Boolean, if `True` the weights of this layer will be marked as</span>
<span class="sd">      trainable (and listed in `layer.trainable_weights`).</span>
<span class="sd">    name: A string, the name of the layer.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">rank</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">conv_op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">rank</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
      <span class="n">filters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span> <span class="ow">or</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span>
        <span class="n">kernel_size</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;kernel_size&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">strides</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;strides&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_padding</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span>
        <span class="n">dilation_rate</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;dilation_rate&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span> <span class="o">=</span> <span class="n">use_bias</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel_initializer</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kernel_regularizer</span> <span class="o">=</span> <span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span> <span class="o">=</span> <span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kernel_constraint</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">min_ndim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_init</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_causal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">==</span> <span class="s1">&#39;causal&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_channels_first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tf_data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_validate_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
          <span class="s1">&#39;The number of filters must be evenly divisible by the number of &#39;</span>
          <span class="s1">&#39;groups. Received: groups=</span><span class="si">{}</span><span class="s1">, filters=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The argument `kernel_size` cannot contain 0(s). &#39;</span>
                       <span class="s1">&#39;Received: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,))</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">==</span> <span class="s1">&#39;causal&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                    <span class="p">(</span><span class="n">Conv1D</span><span class="p">,</span> <span class="n">SeparableConv1D</span><span class="p">))):</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Causal padding is only supported for `Conv1D`&#39;</span>
                       <span class="s1">&#39;and `SeparableConv1D`.&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="n">input_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_channel</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">input_channel</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
          <span class="s1">&#39;The number of input channels must be evenly divisible by the number &#39;</span>
          <span class="s1">&#39;of groups. Received groups=</span><span class="si">{}</span><span class="s1">, but the input has </span><span class="si">{}</span><span class="s1"> channels &#39;</span>
          <span class="s1">&#39;(full input shape is </span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="n">input_channel</span><span class="p">,</span>
                                             <span class="n">input_shape</span><span class="p">))</span>
    <span class="n">kernel_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">input_channel</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kernel&#39;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_initializer</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span>
          <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,),</span>
          <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">,</span>
          <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">,</span>
          <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">,</span>
          <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">min_ndim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="n">channel_axis</span><span class="p">:</span> <span class="n">input_channel</span><span class="p">})</span>

    <span class="c1"># Convert Keras formats to TF native formats.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">==</span> <span class="s1">&#39;causal&#39;</span><span class="p">:</span>
      <span class="n">tf_padding</span> <span class="o">=</span> <span class="s1">&#39;VALID&#39;</span>  <span class="c1"># Causal padding handled in `call`.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
      <span class="n">tf_padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">tf_padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span>
    <span class="n">tf_dilations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">)</span>
    <span class="n">tf_strides</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span>

    <span class="n">tf_op_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="n">tf_op_name</span> <span class="o">==</span> <span class="s1">&#39;Conv1D&#39;</span><span class="p">:</span>
      <span class="n">tf_op_name</span> <span class="o">=</span> <span class="s1">&#39;conv1d&#39;</span>  <span class="c1"># Backwards compat.</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_convolution_op</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="n">nn_ops</span><span class="o">.</span><span class="n">convolution_v2</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">tf_strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">tf_padding</span><span class="p">,</span>
        <span class="n">dilations</span><span class="o">=</span><span class="n">tf_dilations</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tf_data_format</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">tf_op_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">built</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_causal</span><span class="p">:</span>  <span class="c1"># Apply causal padding to inputs for Conv1D.</span>
      <span class="n">inputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_causal_padding</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convolution_op</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">output_rank</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">rank</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channels_first</span><span class="p">:</span>
        <span class="c1"># nn.bias_add does not accept a 1D input tensor.</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">outputs</span> <span class="o">+=</span> <span class="n">bias</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Handle multiple batch dimensions.</span>
        <span class="k">if</span> <span class="n">output_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">output_rank</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>

          <span class="k">def</span> <span class="nf">_apply_fn</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tf_data_format</span><span class="p">)</span>

          <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn_ops</span><span class="o">.</span><span class="n">squeeze_batch_dims</span><span class="p">(</span>
              <span class="n">outputs</span><span class="p">,</span> <span class="n">_apply_fn</span><span class="p">,</span> <span class="n">inner_rank</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
              <span class="n">outputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tf_data_format</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span>

  <span class="k">def</span> <span class="nf">_spatial_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spatial_input_shape</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span>
            <span class="n">length</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
            <span class="n">stride</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spatial_input_shape</span><span class="p">)</span>
    <span class="p">]</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="n">batch_rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="n">input_shape</span><span class="p">[:</span><span class="n">batch_rank</span><span class="p">]</span>
          <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spatial_output_shape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">batch_rank</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
          <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="n">input_shape</span><span class="p">[:</span><span class="n">batch_rank</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">]</span> <span class="o">+</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">_spatial_output_shape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">batch_rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span>

  <span class="k">def</span> <span class="nf">_recreate_conv_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="k">return</span> <span class="kc">False</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;filters&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span>
        <span class="s1">&#39;kernel_size&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="s1">&#39;strides&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="s1">&#39;data_format&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span>
        <span class="s1">&#39;dilation_rate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
        <span class="s1">&#39;activation&#39;</span><span class="p">:</span>
            <span class="n">activations</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">),</span>
        <span class="s1">&#39;use_bias&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="s1">&#39;kernel_initializer&#39;</span><span class="p">:</span>
            <span class="n">initializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="s1">&#39;bias_initializer&#39;</span><span class="p">:</span>
            <span class="n">initializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="s1">&#39;kernel_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;bias_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;activity_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;kernel_constraint&#39;</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="s1">&#39;bias_constraint&#39;</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Conv</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

  <span class="k">def</span> <span class="nf">_compute_causal_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates padding for &#39;causal&#39; option for 1-d conv layers.&quot;&quot;&quot;</span>
    <span class="n">left_pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;ndims&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">batch_rank</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">batch_rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="n">causal_padding</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">batch_rank</span> <span class="o">+</span> <span class="p">[[</span><span class="n">left_pad</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">causal_padding</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">batch_rank</span> <span class="o">+</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">left_pad</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">causal_padding</span>

  <span class="k">def</span> <span class="nf">_get_channel_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

  <span class="k">def</span> <span class="nf">_get_input_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The channel dimension of the inputs &#39;</span>
                       <span class="s1">&#39;should be defined. Found `None`.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">_get_padding_op</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">==</span> <span class="s1">&#39;causal&#39;</span><span class="p">:</span>
      <span class="n">op_padding</span> <span class="o">=</span> <span class="s1">&#39;valid&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">op_padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op_padding</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="n">op_padding</span> <span class="o">=</span> <span class="n">op_padding</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">op_padding</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Conv1D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.Convolution1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Conv1D</span><span class="p">(</span><span class="n">Conv</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;1D convolution layer (e.g. temporal convolution).</span>

<span class="sd">  This layer creates a convolution kernel that is convolved</span>
<span class="sd">  with the layer input over a single spatial (or temporal) dimension</span>
<span class="sd">  to produce a tensor of outputs.</span>
<span class="sd">  If `use_bias` is True, a bias vector is created and added to the outputs.</span>
<span class="sd">  Finally, if `activation` is not `None`,</span>
<span class="sd">  it is applied to the outputs as well.</span>

<span class="sd">  When using this layer as the first layer in a model,</span>
<span class="sd">  provide an `input_shape` argument</span>
<span class="sd">  (tuple of integers or `None`, e.g.</span>
<span class="sd">  `(10, 128)` for sequences of 10 vectors of 128-dimensional vectors,</span>
<span class="sd">  or `(None, 128)` for variable-length sequences of 128-dimensional vectors.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; # The inputs are 128-length vectors with 10 timesteps, and the batch size</span>
<span class="sd">  &gt;&gt;&gt; # is 4.</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 10, 128)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv1D(</span>
<span class="sd">  ... 32, 3, activation=&#39;relu&#39;,input_shape=input_shape[1:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 8, 32)</span>

<span class="sd">  &gt;&gt;&gt; # With extended batch shape [4, 7] (e.g. weather data where batch</span>
<span class="sd">  &gt;&gt;&gt; # dimensions correspond to spatial location and the third dimension</span>
<span class="sd">  &gt;&gt;&gt; # corresponds to time.)</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 7, 10, 128)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv1D(</span>
<span class="sd">  ... 32, 3, activation=&#39;relu&#39;, input_shape=input_shape[2:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 7, 8, 32)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space</span>
<span class="sd">      (i.e. the number of output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of a single integer,</span>
<span class="sd">      specifying the length of the 1D convolution window.</span>
<span class="sd">    strides: An integer or tuple/list of a single integer,</span>
<span class="sd">      specifying the stride length of the convolution.</span>
<span class="sd">      Specifying any stride value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: One of `&quot;valid&quot;`, `&quot;causal&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">      `&quot;causal&quot;` results in causal (dilated) convolutions, e.g. `output[t]`</span>
<span class="sd">      does not depend on `input[t+1:]`. Useful when modeling temporal data</span>
<span class="sd">      where the model should not violate the temporal order.</span>
<span class="sd">      See [WaveNet: A Generative Model for Raw Audio, section</span>
<span class="sd">        2.1](https://arxiv.org/abs/1609.03499).</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">    dilation_rate: an integer or tuple/list of a single integer, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any `strides` value != 1.</span>
<span class="sd">    groups: A positive integer specifying the number of groups in which the</span>
<span class="sd">      input is split along the channel axis. Each group is convolved</span>
<span class="sd">      separately with `filters / groups` filters. The output is the</span>
<span class="sd">      concatenation of all the `groups` results along the channel axis.</span>
<span class="sd">      Input channels and `filters` must both be divisible by `groups`.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    kernel_initializer: Initializer for the `kernel` weights matrix (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    kernel_regularizer: Regularizer function applied to</span>
<span class="sd">      the `kernel` weights matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to</span>
<span class="sd">      the output of the layer (its &quot;activation&quot;) (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    kernel_constraint: Constraint function applied to the kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (</span>
<span class="sd">      see `keras.constraints`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    3+D tensor with shape: `batch_shape + (steps, input_dim)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    3+D tensor with shape: `batch_shape + (new_steps, filters)`</span>
<span class="sd">      `steps` value might have changed due to padding or strides.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 3 representing</span>
<span class="sd">    `activation(conv1d(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: when both `strides &gt; 1` and `dilation_rate &gt; 1`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">kernel_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Conv2D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.Convolution2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Conv2D</span><span class="p">(</span><span class="n">Conv</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;2D convolution layer (e.g. spatial convolution over images).</span>

<span class="sd">  This layer creates a convolution kernel that is convolved</span>
<span class="sd">  with the layer input to produce a tensor of</span>
<span class="sd">  outputs. If `use_bias` is True,</span>
<span class="sd">  a bias vector is created and added to the outputs. Finally, if</span>
<span class="sd">  `activation` is not `None`, it is applied to the outputs as well.</span>

<span class="sd">  When using this layer as the first layer in a model,</span>
<span class="sd">  provide the keyword argument `input_shape`</span>
<span class="sd">  (tuple of integers, does not include the sample axis),</span>
<span class="sd">  e.g. `input_shape=(128, 128, 3)` for 128x128 RGB pictures</span>
<span class="sd">  in `data_format=&quot;channels_last&quot;`.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; # The inputs are 28x28 RGB images with `channels_last` and the batch</span>
<span class="sd">  &gt;&gt;&gt; # size is 4.</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 28, 28, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv2D(</span>
<span class="sd">  ... 2, 3, activation=&#39;relu&#39;, input_shape=input_shape[1:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 26, 26, 2)</span>

<span class="sd">  &gt;&gt;&gt; # With `dilation_rate` as 2.</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 28, 28, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv2D(</span>
<span class="sd">  ... 2, 3, activation=&#39;relu&#39;, dilation_rate=2, input_shape=input_shape[1:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 24, 24, 2)</span>

<span class="sd">  &gt;&gt;&gt; # With `padding` as &quot;same&quot;.</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 28, 28, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv2D(</span>
<span class="sd">  ... 2, 3, activation=&#39;relu&#39;, padding=&quot;same&quot;, input_shape=input_shape[1:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 28, 28, 2)</span>

<span class="sd">  &gt;&gt;&gt; # With extended batch shape [4, 7]:</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 7, 28, 28, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv2D(</span>
<span class="sd">  ... 2, 3, activation=&#39;relu&#39;, input_shape=input_shape[2:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 7, 26, 26, 2)</span>


<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space (i.e. the number of</span>
<span class="sd">      output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of 2 integers, specifying the height</span>
<span class="sd">      and width of the 2D convolution window. Can be a single integer to specify</span>
<span class="sd">      the same value for all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 2 integers, specifying the strides of</span>
<span class="sd">      the convolution along the height and width. Can be a single integer to</span>
<span class="sd">      specify the same value for all spatial dimensions. Specifying any stride</span>
<span class="sd">      value != 1 is incompatible with specifying any `dilation_rate` value != 1.</span>
<span class="sd">    padding: one of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs. `channels_last` corresponds</span>
<span class="sd">      to inputs with shape `(batch_size, height, width, channels)` while</span>
<span class="sd">      `channels_first` corresponds to inputs with shape `(batch_size, channels,</span>
<span class="sd">      height, width)`. It defaults to the `image_data_format` value found in</span>
<span class="sd">      your Keras config file at `~/.keras/keras.json`. If you never set it, then</span>
<span class="sd">      it will be `channels_last`.</span>
<span class="sd">    dilation_rate: an integer or tuple/list of 2 integers, specifying the</span>
<span class="sd">      dilation rate to use for dilated convolution. Can be a single integer to</span>
<span class="sd">      specify the same value for all spatial dimensions. Currently, specifying</span>
<span class="sd">      any `dilation_rate` value != 1 is incompatible with specifying any stride</span>
<span class="sd">      value != 1.</span>
<span class="sd">    groups: A positive integer specifying the number of groups in which the</span>
<span class="sd">      input is split along the channel axis. Each group is convolved separately</span>
<span class="sd">      with `filters / groups` filters. The output is the concatenation of all</span>
<span class="sd">      the `groups` results along the channel axis. Input channels and `filters`</span>
<span class="sd">      must both be divisible by `groups`.</span>
<span class="sd">    activation: Activation function to use. If you don&#39;t specify anything, no</span>
<span class="sd">      activation is applied (see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    kernel_initializer: Initializer for the `kernel` weights matrix (see</span>
<span class="sd">      `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (see</span>
<span class="sd">      `keras.initializers`).</span>
<span class="sd">    kernel_regularizer: Regularizer function applied to the `kernel` weights</span>
<span class="sd">      matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (see</span>
<span class="sd">      `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to the output of the</span>
<span class="sd">      layer (its &quot;activation&quot;) (see `keras.regularizers`).</span>
<span class="sd">    kernel_constraint: Constraint function applied to the kernel matrix (see</span>
<span class="sd">      `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (see</span>
<span class="sd">      `keras.constraints`).</span>
<span class="sd">  Input shape:</span>
<span class="sd">    4+D tensor with shape: `batch_shape + (channels, rows, cols)` if</span>
<span class="sd">      `data_format=&#39;channels_first&#39;`</span>
<span class="sd">    or 4+D tensor with shape: `batch_shape + (rows, cols, channels)` if</span>
<span class="sd">      `data_format=&#39;channels_last&#39;`.</span>
<span class="sd">  Output shape:</span>
<span class="sd">    4+D tensor with shape: `batch_shape + (filters, new_rows, new_cols)` if</span>
<span class="sd">    `data_format=&#39;channels_first&#39;` or 4+D tensor with shape: `batch_shape +</span>
<span class="sd">      (new_rows, new_cols, filters)` if `data_format=&#39;channels_last&#39;`.  `rows`</span>
<span class="sd">      and `cols` values might have changed due to padding.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 4+ representing</span>
<span class="sd">    `activation(conv2d(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is `&quot;causal&quot;`.</span>
<span class="sd">    ValueError: when both `strides &gt; 1` and `dilation_rate &gt; 1`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">kernel_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Conv3D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.Convolution3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Conv3D</span><span class="p">(</span><span class="n">Conv</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;3D convolution layer (e.g. spatial convolution over volumes).</span>

<span class="sd">  This layer creates a convolution kernel that is convolved</span>
<span class="sd">  with the layer input to produce a tensor of</span>
<span class="sd">  outputs. If `use_bias` is True,</span>
<span class="sd">  a bias vector is created and added to the outputs. Finally, if</span>
<span class="sd">  `activation` is not `None`, it is applied to the outputs as well.</span>

<span class="sd">  When using this layer as the first layer in a model,</span>
<span class="sd">  provide the keyword argument `input_shape`</span>
<span class="sd">  (tuple of integers, does not include the sample axis),</span>
<span class="sd">  e.g. `input_shape=(128, 128, 128, 1)` for 128x128x128 volumes</span>
<span class="sd">  with a single channel,</span>
<span class="sd">  in `data_format=&quot;channels_last&quot;`.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; # The inputs are 28x28x28 volumes with a single channel, and the</span>
<span class="sd">  &gt;&gt;&gt; # batch size is 4</span>
<span class="sd">  &gt;&gt;&gt; input_shape =(4, 28, 28, 28, 1)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv3D(</span>
<span class="sd">  ... 2, 3, activation=&#39;relu&#39;, input_shape=input_shape[1:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 26, 26, 26, 2)</span>

<span class="sd">  &gt;&gt;&gt; # With extended batch shape [4, 7], e.g. a batch of 4 videos of 3D frames,</span>
<span class="sd">  &gt;&gt;&gt; # with 7 frames per video.</span>
<span class="sd">  &gt;&gt;&gt; input_shape = (4, 7, 28, 28, 28, 1)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Conv3D(</span>
<span class="sd">  ... 2, 3, activation=&#39;relu&#39;, input_shape=input_shape[2:])(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (4, 7, 26, 26, 26, 2)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space (i.e. the number of</span>
<span class="sd">      output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of 3 integers, specifying the depth,</span>
<span class="sd">      height and width of the 3D convolution window. Can be a single integer to</span>
<span class="sd">      specify the same value for all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 3 integers, specifying the strides of</span>
<span class="sd">      the convolution along each spatial dimension. Can be a single integer to</span>
<span class="sd">      specify the same value for all spatial dimensions. Specifying any stride</span>
<span class="sd">      value != 1 is incompatible with specifying any `dilation_rate` value != 1.</span>
<span class="sd">    padding: one of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs. `channels_last` corresponds</span>
<span class="sd">      to inputs with shape `batch_shape + (spatial_dim1, spatial_dim2,</span>
<span class="sd">      spatial_dim3, channels)` while `channels_first` corresponds to inputs with</span>
<span class="sd">      shape `batch_shape + (channels, spatial_dim1, spatial_dim2,</span>
<span class="sd">      spatial_dim3)`. It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`. If you never set it, then it</span>
<span class="sd">      will be &quot;channels_last&quot;.</span>
<span class="sd">    dilation_rate: an integer or tuple/list of 3 integers, specifying the</span>
<span class="sd">      dilation rate to use for dilated convolution. Can be a single integer to</span>
<span class="sd">      specify the same value for all spatial dimensions. Currently, specifying</span>
<span class="sd">      any `dilation_rate` value != 1 is incompatible with specifying any stride</span>
<span class="sd">      value != 1.</span>
<span class="sd">    groups: A positive integer specifying the number of groups in which the</span>
<span class="sd">      input is split along the channel axis. Each group is convolved separately</span>
<span class="sd">      with `filters / groups` filters. The output is the concatenation of all</span>
<span class="sd">      the `groups` results along the channel axis. Input channels and `filters`</span>
<span class="sd">      must both be divisible by `groups`.</span>
<span class="sd">    activation: Activation function to use. If you don&#39;t specify anything, no</span>
<span class="sd">      activation is applied (see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    kernel_initializer: Initializer for the `kernel` weights matrix (see</span>
<span class="sd">      `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (see</span>
<span class="sd">      `keras.initializers`).</span>
<span class="sd">    kernel_regularizer: Regularizer function applied to the `kernel` weights</span>
<span class="sd">      matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (see</span>
<span class="sd">      `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to the output of the</span>
<span class="sd">      layer (its &quot;activation&quot;) (see `keras.regularizers`).</span>
<span class="sd">    kernel_constraint: Constraint function applied to the kernel matrix (see</span>
<span class="sd">      `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (see</span>
<span class="sd">      `keras.constraints`).</span>
<span class="sd">  Input shape:</span>
<span class="sd">    5+D tensor with shape: `batch_shape + (channels, conv_dim1, conv_dim2,</span>
<span class="sd">      conv_dim3)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 5+D tensor with shape: `batch_shape + (conv_dim1, conv_dim2, conv_dim3,</span>
<span class="sd">      channels)` if data_format=&#39;channels_last&#39;.</span>
<span class="sd">  Output shape:</span>
<span class="sd">    5+D tensor with shape: `batch_shape + (filters, new_conv_dim1,</span>
<span class="sd">      new_conv_dim2, new_conv_dim3)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 5+D tensor with shape: `batch_shape + (new_conv_dim1, new_conv_dim2,</span>
<span class="sd">      new_conv_dim3, filters)` if data_format=&#39;channels_last&#39;. `new_conv_dim1`,</span>
<span class="sd">      `new_conv_dim2` and `new_conv_dim3` values might have changed due to</span>
<span class="sd">      padding.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 5+ representing</span>
<span class="sd">    `activation(conv3d(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is &quot;causal&quot;.</span>
<span class="sd">    ValueError: when both `strides &gt; 1` and `dilation_rate &gt; 1`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">kernel_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Conv1DTranspose&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.Convolution1DTranspose&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Conv1DTranspose</span><span class="p">(</span><span class="n">Conv1D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Transposed convolution layer (sometimes called Deconvolution).</span>

<span class="sd">  The need for transposed convolutions generally arises</span>
<span class="sd">  from the desire to use a transformation going in the opposite direction</span>
<span class="sd">  of a normal convolution, i.e., from something that has the shape of the</span>
<span class="sd">  output of some convolution to something that has the shape of its input</span>
<span class="sd">  while maintaining a connectivity pattern that is compatible with</span>
<span class="sd">  said convolution.</span>

<span class="sd">  When using this layer as the first layer in a model,</span>
<span class="sd">  provide the keyword argument `input_shape`</span>
<span class="sd">  (tuple of integers, does not include the sample axis),</span>
<span class="sd">  e.g. `input_shape=(128, 3)` for data with 128 time steps and 3 channels.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space</span>
<span class="sd">      (i.e. the number of output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer length of the 1D convolution window.</span>
<span class="sd">    strides: An integer specifying the stride of the convolution along the</span>
<span class="sd">      time dimension. Specifying a stride value != 1 is incompatible with</span>
<span class="sd">      specifying a `dilation_rate` value != 1. Defaults to 1.</span>
<span class="sd">    padding: one of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    output_padding: An integer specifying the amount of padding along</span>
<span class="sd">      the time dimension of the output tensor.</span>
<span class="sd">      The amount of output padding must be lower than the stride.</span>
<span class="sd">      If set to `None` (default), the output shape is inferred.</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, length, channels)` while `channels_first` corresponds to</span>
<span class="sd">      inputs with shape `(batch_size, channels, length)`.</span>
<span class="sd">    dilation_rate: an integer, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Currently, specifying a `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying a stride value != 1.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    kernel_initializer: Initializer for the `kernel` weights matrix (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    kernel_regularizer: Regularizer function applied to</span>
<span class="sd">      the `kernel` weights matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to</span>
<span class="sd">      the output of the layer (its &quot;activation&quot;) (see `keras.regularizers`).</span>
<span class="sd">    kernel_constraint: Constraint function applied to the kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (</span>
<span class="sd">      see `keras.constraints`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    3D tensor with shape:</span>
<span class="sd">    `(batch_size, steps, channels)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    3D tensor with shape:</span>
<span class="sd">    `(batch_size, new_steps, filters)`</span>
<span class="sd">    If `output_padding` is specified:</span>
<span class="sd">    ```</span>
<span class="sd">    new_timesteps = ((timesteps - 1) * strides + kernel_size -</span>
<span class="sd">    2 * padding + output_padding)</span>
<span class="sd">    ```</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 3 representing</span>
<span class="sd">    `activation(conv1dtranspose(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is &quot;causal&quot;.</span>
<span class="sd">    ValueError: when both `strides` &gt; 1 and `dilation_rate` &gt; 1.</span>

<span class="sd">  References:</span>
<span class="sd">    - [A guide to convolution arithmetic for deep learning](</span>
<span class="sd">      https://arxiv.org/abs/1603.07285v1)</span>
<span class="sd">    - [Deconvolutional Networks](</span>
<span class="sd">      https://www.matthewzeiler.com/mattzeiler/deconvolutionalnetworks.pdf)</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">output_padding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv1DTranspose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">kernel_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="o">=</span> <span class="n">output_padding</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;output_padding&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">stride</span><span class="p">,</span> <span class="n">out_pad</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out_pad</span> <span class="o">&gt;=</span> <span class="n">stride</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Stride &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; must be &#39;</span>
                           <span class="s1">&#39;greater than output padding &#39;</span> <span class="o">+</span>
                           <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs should have rank 3. Received input shape: &#39;</span> <span class="o">+</span>
                       <span class="nb">str</span><span class="p">(</span><span class="n">input_shape</span><span class="p">))</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The channel dimension of the inputs &#39;</span>
                       <span class="s1">&#39;should be defined. Found `None`.&#39;</span><span class="p">)</span>
    <span class="n">input_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="n">channel_axis</span><span class="p">:</span> <span class="n">input_dim</span><span class="p">})</span>
    <span class="n">kernel_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kernel&#39;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_initializer</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span>
          <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,),</span>
          <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">,</span>
          <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">,</span>
          <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">,</span>
          <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">built</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">inputs_shape</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">t_axis</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">t_axis</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">length</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="n">t_axis</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">output_padding</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">output_padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Infer the dynamic output shape:</span>
    <span class="n">out_length</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">output_padding</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="n">out_length</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">out_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
    <span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">output_shape_tensor</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn_ops</span><span class="o">.</span><span class="n">conv1d_transpose</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span>
        <span class="n">output_shape_tensor</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
      <span class="c1"># Infer the static output shape:</span>
      <span class="n">out_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_output_shape</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="n">outputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">(</span><span class="n">out_shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
          <span class="n">outputs</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
          <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="n">output_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">c_axis</span><span class="p">,</span> <span class="n">t_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">c_axis</span><span class="p">,</span> <span class="n">t_axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">output_padding</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">output_padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">c_axis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">t_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">output_shape</span><span class="p">[</span><span class="n">t_axis</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">output_padding</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Conv1DTranspose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;output_padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Conv2DTranspose&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.Convolution2DTranspose&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Conv2DTranspose</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Transposed convolution layer (sometimes called Deconvolution).</span>

<span class="sd">  The need for transposed convolutions generally arises</span>
<span class="sd">  from the desire to use a transformation going in the opposite direction</span>
<span class="sd">  of a normal convolution, i.e., from something that has the shape of the</span>
<span class="sd">  output of some convolution to something that has the shape of its input</span>
<span class="sd">  while maintaining a connectivity pattern that is compatible with</span>
<span class="sd">  said convolution.</span>

<span class="sd">  When using this layer as the first layer in a model,</span>
<span class="sd">  provide the keyword argument `input_shape`</span>
<span class="sd">  (tuple of integers, does not include the sample axis),</span>
<span class="sd">  e.g. `input_shape=(128, 128, 3)` for 128x128 RGB pictures</span>
<span class="sd">  in `data_format=&quot;channels_last&quot;`.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space</span>
<span class="sd">      (i.e. the number of output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of 2 integers, specifying the</span>
<span class="sd">      height and width of the 2D convolution window.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 2 integers,</span>
<span class="sd">      specifying the strides of the convolution along the height and width.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Specifying any stride value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: one of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    output_padding: An integer or tuple/list of 2 integers,</span>
<span class="sd">      specifying the amount of padding along the height and width</span>
<span class="sd">      of the output tensor.</span>
<span class="sd">      Can be a single integer to specify the same value for all</span>
<span class="sd">      spatial dimensions.</span>
<span class="sd">      The amount of output padding along a given dimension must be</span>
<span class="sd">      lower than the stride along that same dimension.</span>
<span class="sd">      If set to `None` (default), the output shape is inferred.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>
<span class="sd">    dilation_rate: an integer or tuple/list of 2 integers, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any stride value != 1.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    kernel_initializer: Initializer for the `kernel` weights matrix (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    kernel_regularizer: Regularizer function applied to</span>
<span class="sd">      the `kernel` weights matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to</span>
<span class="sd">      the output of the layer (its &quot;activation&quot;) (see `keras.regularizers`).</span>
<span class="sd">    kernel_constraint: Constraint function applied to the kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (</span>
<span class="sd">      see `keras.constraints`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    `(batch_size, channels, rows, cols)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 4D tensor with shape:</span>
<span class="sd">    `(batch_size, rows, cols, channels)` if data_format=&#39;channels_last&#39;.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    `(batch_size, filters, new_rows, new_cols)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 4D tensor with shape:</span>
<span class="sd">    `(batch_size, new_rows, new_cols, filters)` if data_format=&#39;channels_last&#39;.</span>
<span class="sd">    `rows` and `cols` values might have changed due to padding.</span>
<span class="sd">    If `output_padding` is specified:</span>
<span class="sd">    ```</span>
<span class="sd">    new_rows = ((rows - 1) * strides[0] + kernel_size[0] - 2 * padding[0] +</span>
<span class="sd">    output_padding[0])</span>
<span class="sd">    new_cols = ((cols - 1) * strides[1] + kernel_size[1] - 2 * padding[1] +</span>
<span class="sd">    output_padding[1])</span>
<span class="sd">    ```</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 4 representing</span>
<span class="sd">    `activation(conv2dtranspose(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is &quot;causal&quot;.</span>
<span class="sd">    ValueError: when both `strides` &gt; 1 and `dilation_rate` &gt; 1.</span>

<span class="sd">  References:</span>
<span class="sd">    - [A guide to convolution arithmetic for deep</span>
<span class="sd">      learning](https://arxiv.org/abs/1603.07285v1)</span>
<span class="sd">    - [Deconvolutional</span>
<span class="sd">      Networks](https://www.matthewzeiler.com/mattzeiler/deconvolutionalnetworks.pdf)</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">output_padding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv2DTranspose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">kernel_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="o">=</span> <span class="n">output_padding</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;output_padding&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">stride</span><span class="p">,</span> <span class="n">out_pad</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out_pad</span> <span class="o">&gt;=</span> <span class="n">stride</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Stride &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; must be &#39;</span>
                           <span class="s1">&#39;greater than output padding &#39;</span> <span class="o">+</span>
                           <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs should have rank 4. Received input &#39;</span>
                       <span class="s1">&#39;shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_shape</span><span class="p">))</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The channel dimension of the inputs &#39;</span>
                       <span class="s1">&#39;should be defined. Found `None`.&#39;</span><span class="p">)</span>
    <span class="n">input_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="n">channel_axis</span><span class="p">:</span> <span class="n">input_dim</span><span class="p">})</span>
    <span class="n">kernel_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kernel&#39;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_initializer</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span>
          <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,),</span>
          <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">,</span>
          <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">,</span>
          <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">,</span>
          <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">built</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">inputs_shape</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

    <span class="c1"># Use the constant height and weight when possible.</span>
    <span class="c1"># TODO(scottzhu): Extract this into a utility function that can be applied</span>
    <span class="c1"># to all convolutional layers, which currently lost the static shape</span>
    <span class="c1"># information due to tf.shape().</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">dims</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
      <span class="n">height</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="n">h_axis</span><span class="p">]</span>
      <span class="n">width</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="n">w_axis</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="n">h_axis</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="n">w_axis</span><span class="p">]</span>

    <span class="n">kernel_h</span><span class="p">,</span> <span class="n">kernel_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span>
    <span class="n">stride_h</span><span class="p">,</span> <span class="n">stride_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">out_pad_h</span> <span class="o">=</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">out_pad_h</span><span class="p">,</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>

    <span class="c1"># Infer the dynamic output shape:</span>
    <span class="n">out_height</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span><span class="n">height</span><span class="p">,</span>
                                                 <span class="n">kernel_h</span><span class="p">,</span>
                                                 <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                                 <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_h</span><span class="p">,</span>
                                                 <span class="n">stride</span><span class="o">=</span><span class="n">stride_h</span><span class="p">,</span>
                                                 <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">out_width</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span><span class="n">width</span><span class="p">,</span>
                                                <span class="n">kernel_w</span><span class="p">,</span>
                                                <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                                <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_w</span><span class="p">,</span>
                                                <span class="n">stride</span><span class="o">=</span><span class="n">stride_w</span><span class="p">,</span>
                                                <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>

    <span class="n">output_shape_tensor</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">conv2d_transpose</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span>
        <span class="n">output_shape_tensor</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
      <span class="c1"># Infer the static output shape:</span>
      <span class="n">out_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_output_shape</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="n">outputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">(</span><span class="n">out_shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
          <span class="n">outputs</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
          <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="n">output_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">c_axis</span><span class="p">,</span> <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">c_axis</span><span class="p">,</span> <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

    <span class="n">kernel_h</span><span class="p">,</span> <span class="n">kernel_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span>
    <span class="n">stride_h</span><span class="p">,</span> <span class="n">stride_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">out_pad_h</span> <span class="o">=</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">out_pad_h</span><span class="p">,</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>

    <span class="n">output_shape</span><span class="p">[</span><span class="n">c_axis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">h_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">output_shape</span><span class="p">[</span><span class="n">h_axis</span><span class="p">],</span>
        <span class="n">kernel_h</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_h</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="n">stride_h</span><span class="p">,</span>
        <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">w_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">output_shape</span><span class="p">[</span><span class="n">w_axis</span><span class="p">],</span>
        <span class="n">kernel_w</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_w</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="n">stride_w</span><span class="p">,</span>
        <span class="n">dilation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Conv2DTranspose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;output_padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Conv3DTranspose&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.Convolution3DTranspose&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Conv3DTranspose</span><span class="p">(</span><span class="n">Conv3D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Transposed convolution layer (sometimes called Deconvolution).</span>

<span class="sd">  The need for transposed convolutions generally arises</span>
<span class="sd">  from the desire to use a transformation going in the opposite direction</span>
<span class="sd">  of a normal convolution, i.e., from something that has the shape of the</span>
<span class="sd">  output of some convolution to something that has the shape of its input</span>
<span class="sd">  while maintaining a connectivity pattern that is compatible with</span>
<span class="sd">  said convolution.</span>

<span class="sd">  When using this layer as the first layer in a model,</span>
<span class="sd">  provide the keyword argument `input_shape`</span>
<span class="sd">  (tuple of integers, does not include the sample axis),</span>
<span class="sd">  e.g. `input_shape=(128, 128, 128, 3)` for a 128x128x128 volume with 3 channels</span>
<span class="sd">  if `data_format=&quot;channels_last&quot;`.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space</span>
<span class="sd">        (i.e. the number of output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of 3 integers, specifying the</span>
<span class="sd">        depth, height and width of the 3D convolution window.</span>
<span class="sd">        Can be a single integer to specify the same value for</span>
<span class="sd">        all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 3 integers,</span>
<span class="sd">        specifying the strides of the convolution along the depth, height</span>
<span class="sd">          and width.</span>
<span class="sd">        Can be a single integer to specify the same value for</span>
<span class="sd">        all spatial dimensions.</span>
<span class="sd">        Specifying any stride value != 1 is incompatible with specifying</span>
<span class="sd">        any `dilation_rate` value != 1.</span>
<span class="sd">    padding: one of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    output_padding: An integer or tuple/list of 3 integers,</span>
<span class="sd">      specifying the amount of padding along the depth, height, and</span>
<span class="sd">      width.</span>
<span class="sd">      Can be a single integer to specify the same value for all</span>
<span class="sd">      spatial dimensions.</span>
<span class="sd">      The amount of output padding along a given dimension must be</span>
<span class="sd">      lower than the stride along that same dimension.</span>
<span class="sd">      If set to `None` (default), the output shape is inferred.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, depth, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, depth, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>
<span class="sd">    dilation_rate: an integer or tuple/list of 3 integers, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any stride value != 1.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    kernel_initializer: Initializer for the `kernel` weights matrix.</span>
<span class="sd">    bias_initializer: Initializer for the bias vector.</span>
<span class="sd">    kernel_regularizer: Regularizer function applied to</span>
<span class="sd">      the `kernel` weights matrix (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to</span>
<span class="sd">      the output of the layer (its &quot;activation&quot;) (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    kernel_constraint: Constraint function applied to the kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (</span>
<span class="sd">      see `keras.constraints`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    `(batch_size, channels, depth, rows, cols)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 5D tensor with shape:</span>
<span class="sd">    `(batch_size, depth, rows, cols, channels)` if data_format=&#39;channels_last&#39;.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    `(batch_size, filters, new_depth, new_rows, new_cols)` if</span>
<span class="sd">      data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 5D tensor with shape:</span>
<span class="sd">    `(batch_size, new_depth, new_rows, new_cols, filters)` if</span>
<span class="sd">      data_format=&#39;channels_last&#39;.</span>
<span class="sd">    `depth` and `rows` and `cols` values might have changed due to padding.</span>
<span class="sd">    If `output_padding` is specified::</span>
<span class="sd">    ```</span>
<span class="sd">    new_depth = ((depth - 1) * strides[0] + kernel_size[0] - 2 * padding[0] +</span>
<span class="sd">    output_padding[0])</span>
<span class="sd">    new_rows = ((rows - 1) * strides[1] + kernel_size[1] - 2 * padding[1] +</span>
<span class="sd">    output_padding[1])</span>
<span class="sd">    new_cols = ((cols - 1) * strides[2] + kernel_size[2] - 2 * padding[2] +</span>
<span class="sd">    output_padding[2])</span>
<span class="sd">    ```</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 5 representing</span>
<span class="sd">    `activation(conv3dtranspose(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is &quot;causal&quot;.</span>
<span class="sd">    ValueError: when both `strides` &gt; 1 and `dilation_rate` &gt; 1.</span>

<span class="sd">  References:</span>
<span class="sd">    - [A guide to convolution arithmetic for deep</span>
<span class="sd">      learning](https://arxiv.org/abs/1603.07285v1)</span>
<span class="sd">    - [Deconvolutional</span>
<span class="sd">      Networks](https://www.matthewzeiler.com/mattzeiler/deconvolutionalnetworks.pdf)</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">output_padding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Conv3DTranspose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">kernel_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kernel_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="o">=</span> <span class="n">output_padding</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;output_padding&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">stride</span><span class="p">,</span> <span class="n">out_pad</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out_pad</span> <span class="o">&gt;=</span> <span class="n">stride</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Stride &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; must be &#39;</span>
                           <span class="s1">&#39;greater than output padding &#39;</span> <span class="o">+</span>
                           <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs should have rank 5, received input shape:&#39;</span><span class="p">,</span>
                       <span class="nb">str</span><span class="p">(</span><span class="n">input_shape</span><span class="p">))</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The channel dimension of the inputs &#39;</span>
                       <span class="s1">&#39;should be defined, found None: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_shape</span><span class="p">))</span>
    <span class="n">input_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">])</span>
    <span class="n">kernel_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="n">channel_axis</span><span class="p">:</span> <span class="n">input_dim</span><span class="p">})</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="s1">&#39;kernel&#39;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_initializer</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
          <span class="s1">&#39;bias&#39;</span><span class="p">,</span>
          <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,),</span>
          <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">,</span>
          <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">,</span>
          <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">,</span>
          <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">built</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">inputs_shape</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">d_axis</span><span class="p">,</span> <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">d_axis</span><span class="p">,</span> <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>

    <span class="n">depth</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="n">d_axis</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="n">h_axis</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">inputs_shape</span><span class="p">[</span><span class="n">w_axis</span><span class="p">]</span>

    <span class="n">kernel_d</span><span class="p">,</span> <span class="n">kernel_h</span><span class="p">,</span> <span class="n">kernel_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span>
    <span class="n">stride_d</span><span class="p">,</span> <span class="n">stride_h</span><span class="p">,</span> <span class="n">stride_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">out_pad_d</span> <span class="o">=</span> <span class="n">out_pad_h</span> <span class="o">=</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">out_pad_d</span><span class="p">,</span> <span class="n">out_pad_h</span><span class="p">,</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>

    <span class="c1"># Infer the dynamic output shape:</span>
    <span class="n">out_depth</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span>
                                                <span class="n">kernel_d</span><span class="p">,</span>
                                                <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                                <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_d</span><span class="p">,</span>
                                                <span class="n">stride</span><span class="o">=</span><span class="n">stride_d</span><span class="p">)</span>
    <span class="n">out_height</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span><span class="n">height</span><span class="p">,</span>
                                                 <span class="n">kernel_h</span><span class="p">,</span>
                                                 <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                                 <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_h</span><span class="p">,</span>
                                                 <span class="n">stride</span><span class="o">=</span><span class="n">stride_h</span><span class="p">)</span>
    <span class="n">out_width</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span><span class="n">width</span><span class="p">,</span>
                                                <span class="n">kernel_w</span><span class="p">,</span>
                                                <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                                <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_w</span><span class="p">,</span>
                                                <span class="n">stride</span><span class="o">=</span><span class="n">stride_w</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_height</span><span class="p">,</span>
                      <span class="n">out_width</span><span class="p">)</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stride_d</span><span class="p">,</span> <span class="n">stride_h</span><span class="p">,</span> <span class="n">stride_w</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride_d</span><span class="p">,</span> <span class="n">stride_h</span><span class="p">,</span> <span class="n">stride_w</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">output_shape_tensor</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">conv3d_transpose</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span>
        <span class="n">output_shape_tensor</span><span class="p">,</span>
        <span class="n">strides</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
      <span class="c1"># Infer the static output shape:</span>
      <span class="n">out_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_output_shape</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="n">outputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">(</span><span class="n">out_shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
          <span class="n">outputs</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
          <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="n">output_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">c_axis</span><span class="p">,</span> <span class="n">d_axis</span><span class="p">,</span> <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">c_axis</span><span class="p">,</span> <span class="n">d_axis</span><span class="p">,</span> <span class="n">h_axis</span><span class="p">,</span> <span class="n">w_axis</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>

    <span class="n">kernel_d</span><span class="p">,</span> <span class="n">kernel_h</span><span class="p">,</span> <span class="n">kernel_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span>
    <span class="n">stride_d</span><span class="p">,</span> <span class="n">stride_h</span><span class="p">,</span> <span class="n">stride_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">out_pad_d</span> <span class="o">=</span> <span class="n">out_pad_h</span> <span class="o">=</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">out_pad_d</span><span class="p">,</span> <span class="n">out_pad_h</span><span class="p">,</span> <span class="n">out_pad_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>

    <span class="n">output_shape</span><span class="p">[</span><span class="n">c_axis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">d_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">output_shape</span><span class="p">[</span><span class="n">d_axis</span><span class="p">],</span>
        <span class="n">kernel_d</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_d</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="n">stride_d</span><span class="p">)</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">h_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">output_shape</span><span class="p">[</span><span class="n">h_axis</span><span class="p">],</span>
        <span class="n">kernel_h</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_h</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="n">stride_h</span><span class="p">)</span>
    <span class="n">output_shape</span><span class="p">[</span><span class="n">w_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">deconv_output_length</span><span class="p">(</span>
        <span class="n">output_shape</span><span class="p">[</span><span class="n">w_axis</span><span class="p">],</span>
        <span class="n">kernel_w</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">output_padding</span><span class="o">=</span><span class="n">out_pad_w</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="n">stride_w</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Conv3DTranspose</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dilation_rate&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;output_padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_padding</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="k">class</span> <span class="nc">SeparableConv</span><span class="p">(</span><span class="n">Conv</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Abstract base layer for separable nD convolution.</span>

<span class="sd">  This layer performs a depthwise convolution that acts separately on</span>
<span class="sd">  channels, followed by a pointwise convolution that mixes channels.</span>
<span class="sd">  If `use_bias` is True and a bias initializer is provided,</span>
<span class="sd">  it adds a bias vector to the output.</span>
<span class="sd">  It then optionally applies an activation function to produce the final output.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    rank: An integer, the rank of the convolution, e.g. &quot;2&quot; for 2D convolution.</span>
<span class="sd">    filters: Integer, the dimensionality of the output space (i.e. the number</span>
<span class="sd">      of filters in the convolution).</span>
<span class="sd">    kernel_size: A tuple or list of integers specifying the spatial</span>
<span class="sd">      dimensions of the filters. Can be a single integer to specify the same</span>
<span class="sd">      value for all spatial dimensions.</span>
<span class="sd">    strides: A tuple or list of integers specifying the strides</span>
<span class="sd">      of the convolution. Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Specifying any `stride` value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, ..., channels)` while `channels_first` corresponds to</span>
<span class="sd">      inputs with shape `(batch_size, channels, ...)`.</span>
<span class="sd">    dilation_rate: An integer or tuple/list of 2 integers, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any stride value != 1.</span>
<span class="sd">    depth_multiplier: The number of depthwise convolution output channels for</span>
<span class="sd">      each input channel. The total number of depthwise convolution output</span>
<span class="sd">      channels will be equal to `num_filters_in * depth_multiplier`.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias.</span>
<span class="sd">    depthwise_initializer: An initializer for the depthwise convolution kernel.</span>
<span class="sd">    pointwise_initializer: An initializer for the pointwise convolution kernel.</span>
<span class="sd">    bias_initializer: An initializer for the bias vector. If None, the default</span>
<span class="sd">      initializer will be used.</span>
<span class="sd">    depthwise_regularizer: Optional regularizer for the depthwise</span>
<span class="sd">      convolution kernel.</span>
<span class="sd">    pointwise_regularizer: Optional regularizer for the pointwise</span>
<span class="sd">      convolution kernel.</span>
<span class="sd">    bias_regularizer: Optional regularizer for the bias vector.</span>
<span class="sd">    activity_regularizer: Optional regularizer function for the output.</span>
<span class="sd">    depthwise_constraint: Optional projection function to be applied to the</span>
<span class="sd">      depthwise kernel after being updated by an `Optimizer` (e.g. used for</span>
<span class="sd">      norm constraints or value constraints for layer weights). The function</span>
<span class="sd">      must take as input the unprojected variable and must return the</span>
<span class="sd">      projected variable (which must have the same shape). Constraints are</span>
<span class="sd">      not safe to use when doing asynchronous distributed training.</span>
<span class="sd">    pointwise_constraint: Optional projection function to be applied to the</span>
<span class="sd">      pointwise kernel after being updated by an `Optimizer`.</span>
<span class="sd">    bias_constraint: Optional projection function to be applied to the</span>
<span class="sd">      bias after being updated by an `Optimizer`.</span>
<span class="sd">    trainable: Boolean, if `True` the weights of this layer will be marked as</span>
<span class="sd">      trainable (and listed in `layer.trainable_weights`).</span>
<span class="sd">    name: A string, the name of the layer.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">rank</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">depth_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">depthwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">pointwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">depthwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pointwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">depthwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pointwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SeparableConv</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">bias_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span> <span class="o">=</span> <span class="n">depth_multiplier</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_initializer</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_initializer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_initializer</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_initializer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_regularizer</span> <span class="o">=</span> <span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_regularizer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_regularizer</span> <span class="o">=</span> <span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_regularizer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_constraint</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_constraint</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_constraint</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_constraint</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The channel dimension of the inputs &#39;</span>
                       <span class="s1">&#39;should be defined. Found `None`.&#39;</span><span class="p">)</span>
    <span class="n">input_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="n">channel_axis</span><span class="p">:</span> <span class="n">input_dim</span><span class="p">})</span>
    <span class="n">depthwise_kernel_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">input_dim</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span><span class="p">)</span>
    <span class="n">pointwise_kernel_shape</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span> <span class="o">*</span> <span class="n">input_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;depthwise_kernel&#39;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">depthwise_kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_initializer</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pointwise_kernel&#39;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">pointwise_kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_initializer</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_constraint</span><span class="p">,</span>
        <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span>
          <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,),</span>
          <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">,</span>
          <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">,</span>
          <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">,</span>
          <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">built</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;filters&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span>
        <span class="s1">&#39;kernel_size&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="s1">&#39;strides&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="s1">&#39;data_format&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span>
        <span class="s1">&#39;depth_multiplier&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span><span class="p">,</span>
        <span class="s1">&#39;dilation_rate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="s1">&#39;activation&#39;</span><span class="p">:</span>
            <span class="n">activations</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">),</span>
        <span class="s1">&#39;use_bias&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="s1">&#39;depthwise_initializer&#39;</span><span class="p">:</span>
            <span class="n">initializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_initializer</span><span class="p">),</span>
        <span class="s1">&#39;pointwise_initializer&#39;</span><span class="p">:</span>
            <span class="n">initializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_initializer</span><span class="p">),</span>
        <span class="s1">&#39;bias_initializer&#39;</span><span class="p">:</span>
            <span class="n">initializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="s1">&#39;depthwise_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;pointwise_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;bias_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;activity_regularizer&#39;</span><span class="p">:</span>
            <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="s1">&#39;depthwise_constraint&#39;</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_constraint</span><span class="p">),</span>
        <span class="s1">&#39;pointwise_constraint&#39;</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_constraint</span><span class="p">),</span>
        <span class="s1">&#39;bias_constraint&#39;</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SeparableConv</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.SeparableConv1D&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.SeparableConvolution1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SeparableConv1D</span><span class="p">(</span><span class="n">SeparableConv</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Depthwise separable 1D convolution.</span>

<span class="sd">  This layer performs a depthwise convolution that acts separately on</span>
<span class="sd">  channels, followed by a pointwise convolution that mixes channels.</span>
<span class="sd">  If `use_bias` is True and a bias initializer is provided,</span>
<span class="sd">  it adds a bias vector to the output.</span>
<span class="sd">  It then optionally applies an activation function to produce the final output.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space (i.e. the number</span>
<span class="sd">      of filters in the convolution).</span>
<span class="sd">    kernel_size: A single integer specifying the spatial</span>
<span class="sd">      dimensions of the filters.</span>
<span class="sd">    strides: A single integer specifying the strides</span>
<span class="sd">      of the convolution.</span>
<span class="sd">      Specifying any `stride` value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: One of `&quot;valid&quot;`, `&quot;same&quot;`, or `&quot;causal&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, length, channels)` while `channels_first` corresponds to</span>
<span class="sd">      inputs with shape `(batch_size, channels, length)`.</span>
<span class="sd">    dilation_rate: A single integer, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any stride value != 1.</span>
<span class="sd">    depth_multiplier: The number of depthwise convolution output channels for</span>
<span class="sd">      each input channel. The total number of depthwise convolution output</span>
<span class="sd">      channels will be equal to `num_filters_in * depth_multiplier`.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias.</span>
<span class="sd">    depthwise_initializer: An initializer for the depthwise convolution kernel (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    pointwise_initializer: An initializer for the pointwise convolution kernel (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    bias_initializer: An initializer for the bias vector. If None, the default</span>
<span class="sd">      initializer will be used (see `keras.initializers`).</span>
<span class="sd">    depthwise_regularizer: Optional regularizer for the depthwise</span>
<span class="sd">      convolution kernel (see `keras.regularizers`).</span>
<span class="sd">    pointwise_regularizer: Optional regularizer for the pointwise</span>
<span class="sd">      convolution kernel (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Optional regularizer for the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Optional regularizer function for the output (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    depthwise_constraint: Optional projection function to be applied to the</span>
<span class="sd">      depthwise kernel after being updated by an `Optimizer` (e.g. used for</span>
<span class="sd">      norm constraints or value constraints for layer weights). The function</span>
<span class="sd">      must take as input the unprojected variable and must return the</span>
<span class="sd">      projected variable (which must have the same shape). Constraints are</span>
<span class="sd">      not safe to use when doing asynchronous distributed training (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    pointwise_constraint: Optional projection function to be applied to the</span>
<span class="sd">      pointwise kernel after being updated by an `Optimizer` (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Optional projection function to be applied to the</span>
<span class="sd">      bias after being updated by an `Optimizer` (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    trainable: Boolean, if `True` the weights of this layer will be marked as</span>
<span class="sd">      trainable (and listed in `layer.trainable_weights`).</span>
<span class="sd">    name: A string, the name of the layer.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    3D tensor with shape:</span>
<span class="sd">    `(batch_size, channels, steps)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 5D tensor with shape:</span>
<span class="sd">    `(batch_size, steps, channels)` if data_format=&#39;channels_last&#39;.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    3D tensor with shape:</span>
<span class="sd">    `(batch_size, filters, new_steps)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 3D tensor with shape:</span>
<span class="sd">    `(batch_size,  new_steps, filters)` if data_format=&#39;channels_last&#39;.</span>
<span class="sd">    `new_steps` value might have changed due to padding or strides.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 3 representing</span>
<span class="sd">    `activation(separableconv1d(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: when both `strides` &gt; 1 and `dilation_rate` &gt; 1.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">depth_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">depthwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">pointwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">depthwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pointwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">depthwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pointwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SeparableConv1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">depth_multiplier</span><span class="o">=</span><span class="n">depth_multiplier</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">depthwise_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_initializer</span><span class="p">),</span>
        <span class="n">pointwise_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">depthwise_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_regularizer</span><span class="p">),</span>
        <span class="n">pointwise_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">depthwise_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_constraint</span><span class="p">),</span>
        <span class="n">pointwise_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">==</span> <span class="s1">&#39;causal&#39;</span><span class="p">:</span>
      <span class="n">inputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_causal_padding</span><span class="p">())</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
      <span class="n">spatial_start_dim</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">*</span> <span class="mi">2</span>
      <span class="n">spatial_start_dim</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># Explicitly broadcast inputs and kernels to 4D.</span>
    <span class="c1"># TODO(fchollet): refactor when a native separable_conv1d op is available.</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">spatial_start_dim</span><span class="p">)</span>
    <span class="n">depthwise_kernel</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_kernel</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">pointwise_kernel</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_kernel</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dilation_rate</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">==</span> <span class="s1">&#39;causal&#39;</span><span class="p">:</span>
      <span class="n">op_padding</span> <span class="o">=</span> <span class="s1">&#39;valid&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">op_padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">separable_conv2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="n">depthwise_kernel</span><span class="p">,</span>
        <span class="n">pointwise_kernel</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">op_padding</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
        <span class="n">rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
          <span class="n">outputs</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
          <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">outputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="p">[</span><span class="n">spatial_start_dim</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.SeparableConv2D&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.SeparableConvolution2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SeparableConv2D</span><span class="p">(</span><span class="n">SeparableConv</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Depthwise separable 2D convolution.</span>

<span class="sd">  Separable convolutions consist of first performing</span>
<span class="sd">  a depthwise spatial convolution</span>
<span class="sd">  (which acts on each input channel separately)</span>
<span class="sd">  followed by a pointwise convolution which mixes the resulting</span>
<span class="sd">  output channels. The `depth_multiplier` argument controls how many</span>
<span class="sd">  output channels are generated per input channel in the depthwise step.</span>

<span class="sd">  Intuitively, separable convolutions can be understood as</span>
<span class="sd">  a way to factorize a convolution kernel into two smaller kernels,</span>
<span class="sd">  or as an extreme version of an Inception block.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    filters: Integer, the dimensionality of the output space</span>
<span class="sd">      (i.e. the number of output filters in the convolution).</span>
<span class="sd">    kernel_size: An integer or tuple/list of 2 integers, specifying the</span>
<span class="sd">      height and width of the 2D convolution window.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 2 integers,</span>
<span class="sd">      specifying the strides of the convolution along the height and width.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Specifying any stride value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: one of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>
<span class="sd">    dilation_rate: An integer or tuple/list of 2 integers, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any `strides` value != 1.</span>
<span class="sd">    depth_multiplier: The number of depthwise convolution output channels</span>
<span class="sd">      for each input channel.</span>
<span class="sd">      The total number of depthwise convolution output</span>
<span class="sd">      channels will be equal to `filters_in * depth_multiplier`.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    depthwise_initializer: Initializer for the depthwise kernel matrix (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    pointwise_initializer: Initializer for the pointwise kernel matrix (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    depthwise_regularizer: Regularizer function applied to</span>
<span class="sd">      the depthwise kernel matrix (see `keras.regularizers`).</span>
<span class="sd">    pointwise_regularizer: Regularizer function applied to</span>
<span class="sd">      the pointwise kernel matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to</span>
<span class="sd">      the output of the layer (its &quot;activation&quot;) (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    depthwise_constraint: Constraint function applied to</span>
<span class="sd">      the depthwise kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    pointwise_constraint: Constraint function applied to</span>
<span class="sd">      the pointwise kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (</span>
<span class="sd">      see `keras.constraints`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    `(batch_size, channels, rows, cols)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 4D tensor with shape:</span>
<span class="sd">    `(batch_size, rows, cols, channels)` if data_format=&#39;channels_last&#39;.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    `(batch_size, filters, new_rows, new_cols)` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 4D tensor with shape:</span>
<span class="sd">    `(batch_size, new_rows, new_cols, filters)` if data_format=&#39;channels_last&#39;.</span>
<span class="sd">    `rows` and `cols` values might have changed due to padding.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 4 representing</span>
<span class="sd">    `activation(separableconv2d(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is &quot;causal&quot;.</span>
<span class="sd">    ValueError: when both `strides` &gt; 1 and `dilation_rate` &gt; 1.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">filters</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">depth_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">depthwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">pointwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">depthwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pointwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">depthwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pointwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SeparableConv2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">depth_multiplier</span><span class="o">=</span><span class="n">depth_multiplier</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">depthwise_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_initializer</span><span class="p">),</span>
        <span class="n">pointwise_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_initializer</span><span class="p">),</span>
        <span class="n">bias_initializer</span><span class="o">=</span><span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">),</span>
        <span class="n">depthwise_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_regularizer</span><span class="p">),</span>
        <span class="n">pointwise_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_regularizer</span><span class="p">),</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_regularizer</span><span class="p">),</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_regularizer</span><span class="p">),</span>
        <span class="n">depthwise_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_constraint</span><span class="p">),</span>
        <span class="n">pointwise_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pointwise_constraint</span><span class="p">),</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_constraint</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="c1"># Apply the actual ops.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">separable_conv2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_kernel</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_kernel</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
        <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
          <span class="n">outputs</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
          <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.DepthwiseConv2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DepthwiseConv2D</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Depthwise separable 2D convolution.</span>

<span class="sd">  Depthwise Separable convolutions consist of performing</span>
<span class="sd">  just the first step in a depthwise spatial convolution</span>
<span class="sd">  (which acts on each input channel separately).</span>
<span class="sd">  The `depth_multiplier` argument controls how many</span>
<span class="sd">  output channels are generated per input channel in the depthwise step.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    kernel_size: An integer or tuple/list of 2 integers, specifying the</span>
<span class="sd">      height and width of the 2D convolution window.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 2 integers,</span>
<span class="sd">      specifying the strides of the convolution along the height and width.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">      Specifying any stride value != 1 is incompatible with specifying</span>
<span class="sd">      any `dilation_rate` value != 1.</span>
<span class="sd">    padding: one of `&#39;valid&#39;` or `&#39;same&#39;` (case-insensitive).</span>
<span class="sd">    depth_multiplier: The number of depthwise convolution output channels</span>
<span class="sd">      for each input channel.</span>
<span class="sd">      The total number of depthwise convolution output</span>
<span class="sd">      channels will be equal to `filters_in * depth_multiplier`.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &#39;channels_last&#39;.</span>
<span class="sd">    dilation_rate: An integer or tuple/list of 2 integers, specifying</span>
<span class="sd">      the dilation rate to use for dilated convolution.</span>
<span class="sd">      Currently, specifying any `dilation_rate` value != 1 is</span>
<span class="sd">      incompatible with specifying any `strides` value != 1.</span>
<span class="sd">    activation: Activation function to use.</span>
<span class="sd">      If you don&#39;t specify anything, no activation is applied (</span>
<span class="sd">      see `keras.activations`).</span>
<span class="sd">    use_bias: Boolean, whether the layer uses a bias vector.</span>
<span class="sd">    depthwise_initializer: Initializer for the depthwise kernel matrix (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    bias_initializer: Initializer for the bias vector (</span>
<span class="sd">      see `keras.initializers`).</span>
<span class="sd">    depthwise_regularizer: Regularizer function applied to</span>
<span class="sd">      the depthwise kernel matrix (see `keras.regularizers`).</span>
<span class="sd">    bias_regularizer: Regularizer function applied to the bias vector (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    activity_regularizer: Regularizer function applied to</span>
<span class="sd">      the output of the layer (its &#39;activation&#39;) (</span>
<span class="sd">      see `keras.regularizers`).</span>
<span class="sd">    depthwise_constraint: Constraint function applied to</span>
<span class="sd">      the depthwise kernel matrix (</span>
<span class="sd">      see `keras.constraints`).</span>
<span class="sd">    bias_constraint: Constraint function applied to the bias vector (</span>
<span class="sd">      see `keras.constraints`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    `[batch_size, channels, rows, cols]` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 4D tensor with shape:</span>
<span class="sd">    `[batch_size, rows, cols, channels]` if data_format=&#39;channels_last&#39;.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    `[batch_size, filters, new_rows, new_cols]` if data_format=&#39;channels_first&#39;</span>
<span class="sd">    or 4D tensor with shape:</span>
<span class="sd">    `[batch_size, new_rows, new_cols, filters]` if data_format=&#39;channels_last&#39;.</span>
<span class="sd">    `rows` and `cols` values might have changed due to padding.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 4 representing</span>
<span class="sd">    `activation(depthwiseconv2d(inputs, kernel) + bias)`.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: if `padding` is &quot;causal&quot;.</span>
<span class="sd">    ValueError: when both `strides` &gt; 1 and `dilation_rate` &gt; 1.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">kernel_size</span><span class="p">,</span>
               <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">depth_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">depthwise_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span>
               <span class="n">bias_initializer</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
               <span class="n">depthwise_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">depthwise_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DepthwiseConv2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="n">bias_regularizer</span><span class="o">=</span><span class="n">bias_regularizer</span><span class="p">,</span>
        <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">activity_regularizer</span><span class="p">,</span>
        <span class="n">bias_constraint</span><span class="o">=</span><span class="n">bias_constraint</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span> <span class="o">=</span> <span class="n">depth_multiplier</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_initializer</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_initializer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_regularizer</span> <span class="o">=</span> <span class="n">regularizers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_regularizer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_constraint</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depthwise_constraint</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bias_initializer</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs to `DepthwiseConv2D` should have rank 4. &#39;</span>
                       <span class="s1">&#39;Received input shape:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_shape</span><span class="p">))</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="n">channel_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The channel dimension of the inputs to &#39;</span>
                       <span class="s1">&#39;`DepthwiseConv2D` &#39;</span>
                       <span class="s1">&#39;should be defined. Found `None`.&#39;</span><span class="p">)</span>
    <span class="n">input_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="n">channel_axis</span><span class="p">])</span>
    <span class="n">depthwise_kernel_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">input_dim</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">depthwise_kernel_shape</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_initializer</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;depthwise_kernel&#39;</span><span class="p">,</span>
        <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_regularizer</span><span class="p">,</span>
        <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_constraint</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_dim</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span><span class="p">,),</span>
                                  <span class="n">initializer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_initializer</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span>
                                  <span class="n">regularizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_regularizer</span><span class="p">,</span>
                                  <span class="n">constraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_constraint</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Set input spec.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="n">channel_axis</span><span class="p">:</span> <span class="n">input_dim</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">built</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">depthwise_conv2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_kernel</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">dilation_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span>
          <span class="n">outputs</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
          <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputs</span>

  <span class="nd">@tf_utils</span><span class="o">.</span><span class="n">shape_type_conversion</span>
  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">out_filters</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">out_filters</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">dilation_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out_filters</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">out_filters</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DepthwiseConv2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;filters&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kernel_initializer&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kernel_regularizer&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kernel_constraint&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;depth_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_multiplier</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;depthwise_initializer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_initializer</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;depthwise_regularizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regularizers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_regularizer</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;depthwise_constraint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depthwise_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.UpSampling1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UpSampling1D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Upsampling layer for 1D inputs.</span>

<span class="sd">  Repeats each temporal step `size` times along the time axis.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 2, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; print(x)</span>
<span class="sd">  [[[ 0  1  2]</span>
<span class="sd">    [ 3  4  5]]</span>
<span class="sd">   [[ 6  7  8]</span>
<span class="sd">    [ 9 10 11]]]</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.UpSampling1D(size=2)(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y)</span>
<span class="sd">  tf.Tensor(</span>
<span class="sd">    [[[ 0  1  2]</span>
<span class="sd">      [ 0  1  2]</span>
<span class="sd">      [ 3  4  5]</span>
<span class="sd">      [ 3  4  5]]</span>
<span class="sd">     [[ 6  7  8]</span>
<span class="sd">      [ 6  7  8]</span>
<span class="sd">      [ 9 10 11]</span>
<span class="sd">      [ 9 10 11]]], shape=(2, 4, 3), dtype=int64)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    size: Integer. Upsampling factor.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    3D tensor with shape: `(batch_size, steps, features)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    3D tensor with shape: `(batch_size, upsampled_steps, features)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">UpSampling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">repeat_elements</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UpSampling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<div class="viewcode-block" id="UpSampling2D"><a class="viewcode-back" href="../../../../../modules/modeling.html#medsegpy.modeling.layers.pooling.UpSampling2D">[docs]</a><span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.UpSampling2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UpSampling2D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Upsampling layer for 2D inputs.</span>

<span class="sd">  Repeats the rows and columns of the data</span>
<span class="sd">  by `size[0]` and `size[1]` respectively.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 2, 1, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; print(x)</span>
<span class="sd">  [[[[ 0  1  2]]</span>
<span class="sd">    [[ 3  4  5]]]</span>
<span class="sd">   [[[ 6  7  8]]</span>
<span class="sd">    [[ 9 10 11]]]]</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.UpSampling2D(size=(1, 2))(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y)</span>
<span class="sd">  tf.Tensor(</span>
<span class="sd">    [[[[ 0  1  2]</span>
<span class="sd">       [ 0  1  2]]</span>
<span class="sd">      [[ 3  4  5]</span>
<span class="sd">       [ 3  4  5]]]</span>
<span class="sd">     [[[ 6  7  8]</span>
<span class="sd">       [ 6  7  8]]</span>
<span class="sd">      [[ 9 10 11]</span>
<span class="sd">       [ 9 10 11]]]], shape=(2, 2, 2, 3), dtype=int64)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    size: Int, or tuple of 2 integers.</span>
<span class="sd">      The upsampling factors for rows and columns.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>
<span class="sd">    interpolation: A string, one of `nearest` or `bilinear`.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, rows, cols, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, channels, rows, cols)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, upsampled_rows, upsampled_cols, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, channels, upsampled_rows, upsampled_cols)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">UpSampling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">}:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`interpolation` argument should be one of `&quot;nearest&quot;` &#39;</span>
                       <span class="s1">&#39;or `&quot;bilinear&quot;`.&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">resize_images</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
        <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span>
        <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UpSampling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span></div>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.UpSampling3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UpSampling3D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Upsampling layer for 3D inputs.</span>

<span class="sd">  Repeats the 1st, 2nd and 3rd dimensions</span>
<span class="sd">  of the data by `size[0]`, `size[1]` and `size[2]` respectively.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 1, 2, 1, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.constant(1, shape=input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.UpSampling3D(size=2)(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (2, 2, 4, 2, 3)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    size: Int, or tuple of 3 integers.</span>
<span class="sd">      The upsampling factors for dim1, dim2 and dim3.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, dim1, dim2, dim3, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, channels, dim1, dim2, dim3)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, upsampled_dim1, upsampled_dim2, upsampled_dim3, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, channels, upsampled_dim1, upsampled_dim2, upsampled_dim3)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">UpSampling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">dim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="n">dim2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="n">dim3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">dim3</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">dim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="n">dim2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="n">dim3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_shape</span><span class="p">[</span>
          <span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">dim3</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">resize_volumes</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UpSampling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.ZeroPadding1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ZeroPadding1D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Zero-padding layer for 1D input (e.g. temporal sequence).</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 2, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; print(x)</span>
<span class="sd">  [[[ 0  1  2]</span>
<span class="sd">    [ 3  4  5]]</span>
<span class="sd">   [[ 6  7  8]</span>
<span class="sd">    [ 9 10 11]]]</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.ZeroPadding1D(padding=2)(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y)</span>
<span class="sd">  tf.Tensor(</span>
<span class="sd">    [[[ 0  0  0]</span>
<span class="sd">      [ 0  0  0]</span>
<span class="sd">      [ 0  1  2]</span>
<span class="sd">      [ 3  4  5]</span>
<span class="sd">      [ 0  0  0]</span>
<span class="sd">      [ 0  0  0]]</span>
<span class="sd">     [[ 0  0  0]</span>
<span class="sd">      [ 0  0  0]</span>
<span class="sd">      [ 6  7  8]</span>
<span class="sd">      [ 9 10 11]</span>
<span class="sd">      [ 0  0  0]</span>
<span class="sd">      [ 0  0  0]]], shape=(2, 6, 3), dtype=int64)</span>

<span class="sd">  Arguments:</span>
<span class="sd">      padding: Int, or tuple of int (length 2), or dictionary.</span>
<span class="sd">          - If int:</span>
<span class="sd">          How many zeros to add at the beginning and end of</span>
<span class="sd">          the padding dimension (axis 1).</span>
<span class="sd">          - If tuple of int (length 2):</span>
<span class="sd">          How many zeros to add at the beginning and the end of</span>
<span class="sd">          the padding dimension (`(left_pad, right_pad)`).</span>

<span class="sd">  Input shape:</span>
<span class="sd">      3D tensor with shape `(batch_size, axis_to_pad, features)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">      3D tensor with shape `(batch_size, padded_axis, features)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ZeroPadding1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">length</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">length</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">temporal_padding</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ZeroPadding1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.ZeroPadding2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ZeroPadding2D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Zero-padding layer for 2D input (e.g. picture).</span>

<span class="sd">  This layer can add rows and columns of zeros</span>
<span class="sd">  at the top, bottom, left and right side of an image tensor.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (1, 1, 2, 2)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; print(x)</span>
<span class="sd">  [[[[0 1]</span>
<span class="sd">     [2 3]]]]</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.ZeroPadding2D(padding=1)(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y)</span>
<span class="sd">  tf.Tensor(</span>
<span class="sd">    [[[[0 0]</span>
<span class="sd">       [0 0]</span>
<span class="sd">       [0 0]</span>
<span class="sd">       [0 0]]</span>
<span class="sd">      [[0 0]</span>
<span class="sd">       [0 1]</span>
<span class="sd">       [2 3]</span>
<span class="sd">       [0 0]]</span>
<span class="sd">      [[0 0]</span>
<span class="sd">       [0 0]</span>
<span class="sd">       [0 0]</span>
<span class="sd">       [0 0]]]], shape=(1, 3, 4, 2), dtype=int64)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    padding: Int, or tuple of 2 ints, or tuple of 2 tuples of 2 ints.</span>
<span class="sd">      - If int: the same symmetric padding</span>
<span class="sd">        is applied to height and width.</span>
<span class="sd">      - If tuple of 2 ints:</span>
<span class="sd">        interpreted as two different</span>
<span class="sd">        symmetric padding values for height and width:</span>
<span class="sd">        `(symmetric_height_pad, symmetric_width_pad)`.</span>
<span class="sd">      - If tuple of 2 tuples of 2 ints:</span>
<span class="sd">        interpreted as</span>
<span class="sd">        `((top_pad, bottom_pad), (left_pad, right_pad))`</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, rows, cols, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, channels, rows, cols)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, padded_rows, padded_cols, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, channels, padded_rows, padded_cols)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ZeroPadding2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">((</span><span class="n">padding</span><span class="p">,</span> <span class="n">padding</span><span class="p">),</span> <span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="n">padding</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`padding` should have two elements. &#39;</span>
                         <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">padding</span><span class="p">))</span>
      <span class="n">height_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                  <span class="s1">&#39;1st entry of padding&#39;</span><span class="p">)</span>
      <span class="n">width_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                 <span class="s1">&#39;2nd entry of padding&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">height_padding</span><span class="p">,</span> <span class="n">width_padding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`padding` should be either an int, &#39;</span>
                       <span class="s1">&#39;a tuple of 2 ints &#39;</span>
                       <span class="s1">&#39;(symmetric_height_pad, symmetric_width_pad), &#39;</span>
                       <span class="s1">&#39;or a tuple of 2 tuples of 2 ints &#39;</span>
                       <span class="s1">&#39;((top_pad, bottom_pad), (left_pad, right_pad)). &#39;</span>
                       <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">padding</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">])</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">spatial_2d_padding</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ZeroPadding2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.ZeroPadding3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ZeroPadding3D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Zero-padding layer for 3D data (spatial or spatio-temporal).</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (1, 1, 2, 2, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.ZeroPadding3D(padding=2)(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (1, 5, 6, 6, 3)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    padding: Int, or tuple of 3 ints, or tuple of 3 tuples of 2 ints.</span>
<span class="sd">      - If int: the same symmetric padding</span>
<span class="sd">        is applied to height and width.</span>
<span class="sd">      - If tuple of 3 ints:</span>
<span class="sd">        interpreted as two different</span>
<span class="sd">        symmetric padding values for height and width:</span>
<span class="sd">        `(symmetric_dim1_pad, symmetric_dim2_pad, symmetric_dim3_pad)`.</span>
<span class="sd">      - If tuple of 3 tuples of 2 ints:</span>
<span class="sd">        interpreted as</span>
<span class="sd">        `((left_dim1_pad, right_dim1_pad), (left_dim2_pad,</span>
<span class="sd">          right_dim2_pad), (left_dim3_pad, right_dim3_pad))`</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, first_axis_to_pad, second_axis_to_pad, third_axis_to_pad,</span>
<span class="sd">          depth)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, depth, first_axis_to_pad, second_axis_to_pad,</span>
<span class="sd">          third_axis_to_pad)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">        `(batch_size, first_padded_axis, second_padded_axis, third_axis_to_pad,</span>
<span class="sd">          depth)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">        `(batch_size, depth, first_padded_axis, second_padded_axis,</span>
<span class="sd">          third_axis_to_pad)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ZeroPadding3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">((</span><span class="n">padding</span><span class="p">,</span> <span class="n">padding</span><span class="p">),</span> <span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="n">padding</span><span class="p">),</span> <span class="p">(</span><span class="n">padding</span><span class="p">,</span>
                                                               <span class="n">padding</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`padding` should have 3 elements. &#39;</span>
                         <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">padding</span><span class="p">))</span>
      <span class="n">dim1_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                <span class="s1">&#39;1st entry of padding&#39;</span><span class="p">)</span>
      <span class="n">dim2_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                <span class="s1">&#39;2nd entry of padding&#39;</span><span class="p">)</span>
      <span class="n">dim3_padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                <span class="s1">&#39;3rd entry of padding&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim1_padding</span><span class="p">,</span> <span class="n">dim2_padding</span><span class="p">,</span> <span class="n">dim3_padding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
          <span class="s1">&#39;`padding` should be either an int, &#39;</span>
          <span class="s1">&#39;a tuple of 3 ints &#39;</span>
          <span class="s1">&#39;(symmetric_dim1_pad, symmetric_dim2_pad, symmetric_dim3_pad), &#39;</span>
          <span class="s1">&#39;or a tuple of 3 tuples of 2 ints &#39;</span>
          <span class="s1">&#39;((left_dim1_pad, right_dim1_pad),&#39;</span>
          <span class="s1">&#39; (left_dim2_pad, right_dim2_pad),&#39;</span>
          <span class="s1">&#39; (left_dim3_pad, right_dim2_pad)). &#39;</span>
          <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">padding</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">dim3</span><span class="p">])</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">dim3</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">spatial_3d_padding</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ZeroPadding3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Cropping1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Cropping1D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Cropping layer for 1D input (e.g. temporal sequence).</span>

<span class="sd">  It crops along the time dimension (axis 1).</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 3, 2)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; print(x)</span>
<span class="sd">  [[[ 0  1]</span>
<span class="sd">    [ 2  3]</span>
<span class="sd">    [ 4  5]]</span>
<span class="sd">   [[ 6  7]</span>
<span class="sd">    [ 8  9]</span>
<span class="sd">    [10 11]]]</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Cropping1D(cropping=1)(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y)</span>
<span class="sd">  tf.Tensor(</span>
<span class="sd">    [[[2 3]]</span>
<span class="sd">     [[8 9]]], shape=(2, 1, 2), dtype=int64)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    cropping: Int or tuple of int (length 2)</span>
<span class="sd">      How many units should be trimmed off at the beginning and end of</span>
<span class="sd">      the cropping dimension (axis 1).</span>
<span class="sd">      If a single int is provided, the same value will be used for both.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    3D tensor with shape `(batch_size, axis_to_crop, features)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    3D tensor with shape `(batch_size, cropped_axis, features)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cropping</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Cropping1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;cropping&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">length</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">length</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cropping&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Cropping1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Cropping2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Cropping2D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Cropping layer for 2D input (e.g. picture).</span>

<span class="sd">  It crops along spatial dimensions, i.e. height and width.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 28, 28, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Cropping2D(cropping=((2, 2), (4, 4)))(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (2, 24, 20, 3)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    cropping: Int, or tuple of 2 ints, or tuple of 2 tuples of 2 ints.</span>
<span class="sd">      - If int: the same symmetric cropping</span>
<span class="sd">        is applied to height and width.</span>
<span class="sd">      - If tuple of 2 ints:</span>
<span class="sd">        interpreted as two different</span>
<span class="sd">        symmetric cropping values for height and width:</span>
<span class="sd">        `(symmetric_height_crop, symmetric_width_crop)`.</span>
<span class="sd">      - If tuple of 2 tuples of 2 ints:</span>
<span class="sd">        interpreted as</span>
<span class="sd">        `((top_crop, bottom_crop), (left_crop, right_crop))`</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">      `(batch_size, rows, cols, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">      `(batch_size, channels, rows, cols)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    4D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">      `(batch_size, cropped_rows, cropped_cols, channels)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">      `(batch_size, channels, cropped_rows, cropped_cols)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cropping</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Cropping2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span> <span class="o">=</span> <span class="p">((</span><span class="n">cropping</span><span class="p">,</span> <span class="n">cropping</span><span class="p">),</span> <span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="n">cropping</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cropping</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`cropping` should have two elements. &#39;</span>
                         <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cropping</span><span class="p">))</span>
      <span class="n">height_cropping</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                   <span class="s1">&#39;1st entry of cropping&#39;</span><span class="p">)</span>
      <span class="n">width_cropping</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                  <span class="s1">&#39;2nd entry of cropping&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span> <span class="o">=</span> <span class="p">(</span><span class="n">height_cropping</span><span class="p">,</span> <span class="n">width_cropping</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`cropping` should be either an int, &#39;</span>
                       <span class="s1">&#39;a tuple of 2 ints &#39;</span>
                       <span class="s1">&#39;(symmetric_height_crop, symmetric_width_crop), &#39;</span>
                       <span class="s1">&#39;or a tuple of 2 tuples of 2 ints &#39;</span>
                       <span class="s1">&#39;((top_crop, bottom_crop), (left_crop, right_crop)). &#39;</span>
                       <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cropping</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span>
          <span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
          <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
      <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span>
          <span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="p">])</span>
    <span class="c1"># pylint: enable=invalid-unary-operand-type</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span>
      <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
      <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span>
          <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>  <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
    <span class="c1"># pylint: enable=invalid-unary-operand-type</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cropping&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">,</span> <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Cropping2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.Cropping3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Cropping3D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Cropping layer for 3D data (e.g. spatial or spatio-temporal).</span>

<span class="sd">    Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 28, 28, 10, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = np.arange(np.prod(input_shape)).reshape(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.Cropping3D(cropping=(2, 4, 2))(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (2, 24, 20, 6, 3)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    cropping: Int, or tuple of 3 ints, or tuple of 3 tuples of 2 ints.</span>
<span class="sd">      - If int: the same symmetric cropping</span>
<span class="sd">        is applied to depth, height, and width.</span>
<span class="sd">      - If tuple of 3 ints: interpreted as two different</span>
<span class="sd">        symmetric cropping values for depth, height, and width:</span>
<span class="sd">        `(symmetric_dim1_crop, symmetric_dim2_crop, symmetric_dim3_crop)`.</span>
<span class="sd">      - If tuple of 3 tuples of 2 ints: interpreted as</span>
<span class="sd">        `((left_dim1_crop, right_dim1_crop), (left_dim2_crop,</span>
<span class="sd">          right_dim2_crop), (left_dim3_crop, right_dim3_crop))`</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">      `(batch_size, first_axis_to_crop, second_axis_to_crop, third_axis_to_crop,</span>
<span class="sd">        depth)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">      `(batch_size, depth, first_axis_to_crop, second_axis_to_crop,</span>
<span class="sd">        third_axis_to_crop)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    5D tensor with shape:</span>
<span class="sd">    - If `data_format` is `&quot;channels_last&quot;`:</span>
<span class="sd">      `(batch_size, first_cropped_axis, second_cropped_axis, third_cropped_axis,</span>
<span class="sd">        depth)`</span>
<span class="sd">    - If `data_format` is `&quot;channels_first&quot;`:</span>
<span class="sd">      `(batch_size, depth, first_cropped_axis, second_cropped_axis,</span>
<span class="sd">        third_cropped_axis)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">cropping</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Cropping3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span> <span class="o">=</span> <span class="p">((</span><span class="n">cropping</span><span class="p">,</span> <span class="n">cropping</span><span class="p">),</span> <span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="n">cropping</span><span class="p">),</span> <span class="p">(</span><span class="n">cropping</span><span class="p">,</span>
                                                                    <span class="n">cropping</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cropping</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`cropping` should have 3 elements. &#39;</span>
                         <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cropping</span><span class="p">))</span>
      <span class="n">dim1_cropping</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                 <span class="s1">&#39;1st entry of cropping&#39;</span><span class="p">)</span>
      <span class="n">dim2_cropping</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                 <span class="s1">&#39;2nd entry of cropping&#39;</span><span class="p">)</span>
      <span class="n">dim3_cropping</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
                                                 <span class="s1">&#39;3rd entry of cropping&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim1_cropping</span><span class="p">,</span> <span class="n">dim2_cropping</span><span class="p">,</span> <span class="n">dim3_cropping</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
          <span class="s1">&#39;`cropping` should be either an int, &#39;</span>
          <span class="s1">&#39;a tuple of 3 ints &#39;</span>
          <span class="s1">&#39;(symmetric_dim1_crop, symmetric_dim2_crop, symmetric_dim3_crop), &#39;</span>
          <span class="s1">&#39;or a tuple of 3 tuples of 2 ints &#39;</span>
          <span class="s1">&#39;((left_dim1_crop, right_dim1_crop),&#39;</span>
          <span class="s1">&#39; (left_dim2_crop, right_dim2_crop),&#39;</span>
          <span class="s1">&#39; (left_dim3_crop, right_dim2_crop)). &#39;</span>
          <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cropping</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">dim3</span><span class="p">])</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dim3</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">dim3</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="c1"># pylint: enable=invalid-unary-operand-type</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span>
            <span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span>
                      <span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span>
                      <span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span>
      <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span>
                        <span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span>
            <span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span>
            <span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span>
                          <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:]</span>
      <span class="k">return</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span>
          <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>  <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
    <span class="c1"># pylint: enable=invalid-unary-operand-type</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cropping&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">,</span> <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Cropping3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="c1"># Aliases</span>

<span class="n">Convolution1D</span> <span class="o">=</span> <span class="n">Conv1D</span>
<span class="n">Convolution2D</span> <span class="o">=</span> <span class="n">Conv2D</span>
<span class="n">Convolution3D</span> <span class="o">=</span> <span class="n">Conv3D</span>
<span class="n">SeparableConvolution1D</span> <span class="o">=</span> <span class="n">SeparableConv1D</span>
<span class="n">SeparableConvolution2D</span> <span class="o">=</span> <span class="n">SeparableConv2D</span>
<span class="n">Convolution2DTranspose</span> <span class="o">=</span> <span class="n">Conv2DTranspose</span>
<span class="n">Convolution3DTranspose</span> <span class="o">=</span> <span class="n">Conv3DTranspose</span>
<span class="n">Deconvolution2D</span> <span class="o">=</span> <span class="n">Deconv2D</span> <span class="o">=</span> <span class="n">Conv2DTranspose</span>
<span class="n">Deconvolution3D</span> <span class="o">=</span> <span class="n">Deconv3D</span> <span class="o">=</span> <span class="n">Conv3DTranspose</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2021, Arjun Desai.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>