

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tensorflow.python.keras.layers.pooling &mdash; MedSegPy 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../../../',
              VERSION:'0.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> MedSegPy
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorials/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules/index.html">API Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">MedSegPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
      <li>tensorflow.python.keras.layers.pooling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tensorflow.python.keras.layers.pooling</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2015 The TensorFlow Authors. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ==============================================================================</span>
<span class="sd">&quot;&quot;&quot;Pooling layers.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">from</span> <span class="nn">tensorflow.python.framework</span> <span class="kn">import</span> <span class="n">tensor_shape</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras</span> <span class="kn">import</span> <span class="n">backend</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.engine.base_layer</span> <span class="kn">import</span> <span class="n">Layer</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.engine.input_spec</span> <span class="kn">import</span> <span class="n">InputSpec</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.keras.utils</span> <span class="kn">import</span> <span class="n">conv_utils</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.ops</span> <span class="kn">import</span> <span class="n">array_ops</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.ops</span> <span class="kn">import</span> <span class="n">math_ops</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.ops</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.util.tf_export</span> <span class="kn">import</span> <span class="n">keras_export</span>


<span class="k">class</span> <span class="nc">Pooling1D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Pooling layer for arbitrary pooling functions, for 1D inputs.</span>

<span class="sd">  This class only exists for code reuse. It will never be an exposed API.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_function: The pooling function to apply, e.g. `tf.nn.max_pool2d`.</span>
<span class="sd">    pool_size: An integer or tuple/list of a single integer,</span>
<span class="sd">      representing the size of the pooling window.</span>
<span class="sd">    strides: An integer or tuple/list of a single integer, specifying the</span>
<span class="sd">      strides of the pooling operation.</span>
<span class="sd">    padding: A string. The padding method, either &#39;valid&#39; or &#39;same&#39;.</span>
<span class="sd">      Case-insensitive.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, steps, features)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, features, steps)`.</span>
<span class="sd">    name: A string, the name of the layer.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_function</span><span class="p">,</span> <span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Pooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">data_format</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">image_data_format</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="n">pool_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pool_function</span> <span class="o">=</span> <span class="n">pool_function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">pool_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;pool_size&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">strides</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;strides&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_padding</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">pad_axis</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span> <span class="k">else</span> <span class="mi">3</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">pad_axis</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_function</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
        <span class="n">strides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">pad_axis</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">steps</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">features</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">steps</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">features</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">features</span><span class="p">,</span> <span class="n">length</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="p">,</span> <span class="n">features</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;strides&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="s1">&#39;pool_size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">,</span>
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Pooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.MaxPool1D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.MaxPooling1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MaxPooling1D</span><span class="p">(</span><span class="n">Pooling1D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Max pooling operation for 1D temporal data.</span>

<span class="sd">  Downsamples the input representation by taking the maximum value over the</span>
<span class="sd">  window defined by `pool_size`. The window is shifted by `strides`.  The</span>
<span class="sd">  resulting output when using &quot;valid&quot; padding option has a shape of:</span>
<span class="sd">  `output_shape = (input_shape - pool_size + 1) / strides)`</span>

<span class="sd">  The resulting output shape when using the &quot;same&quot; padding option is:</span>
<span class="sd">  `output_shape = input_shape / strides`</span>

<span class="sd">  For example, for strides=1 and padding=&quot;valid&quot;:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([1., 2., 3., 4., 5.])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [1, 5, 1])</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d = tf.keras.layers.MaxPooling1D(pool_size=2,</span>
<span class="sd">  ...    strides=1, padding=&#39;valid&#39;)</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(1, 4, 1), dtype=float32, numpy=</span>
<span class="sd">  array([[[2.],</span>
<span class="sd">          [3.],</span>
<span class="sd">          [4.],</span>
<span class="sd">          [5.]]], dtype=float32)&gt;</span>

<span class="sd">  For example, for strides=2 and padding=&quot;valid&quot;:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([1., 2., 3., 4., 5.])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [1, 5, 1])</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d = tf.keras.layers.MaxPooling1D(pool_size=2,</span>
<span class="sd">  ...    strides=2, padding=&#39;valid&#39;)</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(1, 2, 1), dtype=float32, numpy=</span>
<span class="sd">  array([[[2.],</span>
<span class="sd">          [4.]]], dtype=float32)&gt;</span>

<span class="sd">  For example, for strides=1 and padding=&quot;same&quot;:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([1., 2., 3., 4., 5.])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [1, 5, 1])</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d = tf.keras.layers.MaxPooling1D(pool_size=2,</span>
<span class="sd">  ...    strides=1, padding=&#39;same&#39;)</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(1, 5, 1), dtype=float32, numpy=</span>
<span class="sd">  array([[[2.],</span>
<span class="sd">          [3.],</span>
<span class="sd">          [4.],</span>
<span class="sd">          [5.],</span>
<span class="sd">          [5.]]], dtype=float32)&gt;</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_size: Integer, size of the max pooling window.</span>
<span class="sd">    strides: Integer, or None. Specifies how much the pooling window moves</span>
<span class="sd">      for each pooling step.</span>
<span class="sd">      If None, it will default to `pool_size`.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">      &quot;valid&quot; adds no padding.  &quot;same&quot; adds padding such that if the stride</span>
<span class="sd">      is 1, the output shape is the same as the input shape.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, steps, features)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, features, steps)`.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, steps, features)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, features, steps)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, downsampled_steps, features)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, features, downsampled_steps)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">MaxPooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">pool2d</span><span class="p">,</span> <span class="n">pool_mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">),</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="n">pool_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.AveragePooling1D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.AvgPool1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AveragePooling1D</span><span class="p">(</span><span class="n">Pooling1D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Average pooling for temporal data.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_size: Integer, size of the average pooling windows.</span>
<span class="sd">    strides: Integer, or None. Factor by which to downscale.</span>
<span class="sd">      E.g. 2 will halve the input.</span>
<span class="sd">      If None, it will default to `pool_size`.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, steps, features)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, features, steps)`.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, steps, features)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, features, steps)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, downsampled_steps, features)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      3D tensor with shape `(batch_size, features, downsampled_steps)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">AveragePooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">pool2d</span><span class="p">,</span> <span class="n">pool_mode</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span><span class="p">),</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="n">pool_size</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Pooling2D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Pooling layer for arbitrary pooling functions, for 2D inputs (e.g. images).</span>

<span class="sd">  This class only exists for code reuse. It will never be an exposed API.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_function: The pooling function to apply, e.g. `tf.nn.max_pool2d`.</span>
<span class="sd">    pool_size: An integer or tuple/list of 2 integers: (pool_height, pool_width)</span>
<span class="sd">      specifying the size of the pooling window.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 2 integers,</span>
<span class="sd">      specifying the strides of the pooling operation.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    padding: A string. The padding method, either &#39;valid&#39; or &#39;same&#39;.</span>
<span class="sd">      Case-insensitive.</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, height, width, channels)` while `channels_first` corresponds to</span>
<span class="sd">      inputs with shape `(batch, channels, height, width)`.</span>
<span class="sd">    name: A string, the name of the layer.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_function</span><span class="p">,</span> <span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Pooling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">data_format</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">image_data_format</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="n">pool_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pool_function</span> <span class="o">=</span> <span class="n">pool_function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">pool_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;pool_size&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">strides</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;strides&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_padding</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="n">pool_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pool_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_function</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="n">ksize</span><span class="o">=</span><span class="n">pool_shape</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
        <span class="n">data_format</span><span class="o">=</span><span class="n">conv_utils</span><span class="o">.</span><span class="n">convert_data_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">outputs</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pool_size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">,</span>
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="s1">&#39;strides&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span>
    <span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Pooling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<div class="viewcode-block" id="MaxPooling2D"><a class="viewcode-back" href="../../../../../modules/modeling.html#medsegpy.modeling.layers.pooling.MaxPooling2D">[docs]</a><span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.MaxPool2D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.MaxPooling2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MaxPooling2D</span><span class="p">(</span><span class="n">Pooling2D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Max pooling operation for 2D spatial data.</span>

<span class="sd">  Downsamples the input representation by taking the maximum value over the</span>
<span class="sd">  window defined by `pool_size` for each dimension along the features axis.</span>
<span class="sd">  The window is shifted by `strides` in each dimension.  The resulting output</span>
<span class="sd">  when using &quot;valid&quot; padding option has a shape(number of rows or columns) of:</span>
<span class="sd">  `output_shape = (input_shape - pool_size + 1) / strides)`</span>

<span class="sd">  The resulting output shape when using the &quot;same&quot; padding option is:</span>
<span class="sd">  `output_shape = input_shape / strides`</span>

<span class="sd">  For example, for stride=(1,1) and padding=&quot;valid&quot;:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([[1., 2., 3.],</span>
<span class="sd">  ...                  [4., 5., 6.],</span>
<span class="sd">  ...                  [7., 8., 9.]])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [1, 3, 3, 1])</span>
<span class="sd">  &gt;&gt;&gt; max_pool_2d = tf.keras.layers.MaxPooling2D(pool_size=(2, 2),</span>
<span class="sd">  ...    strides=(1, 1), padding=&#39;valid&#39;)</span>
<span class="sd">  &gt;&gt;&gt; max_pool_2d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(1, 2, 2, 1), dtype=float32, numpy=</span>
<span class="sd">    array([[[[5.],</span>
<span class="sd">             [6.]],</span>
<span class="sd">            [[8.],</span>
<span class="sd">             [9.]]]], dtype=float32)&gt;</span>

<span class="sd">  For example, for stride=(2,2) and padding=&quot;valid&quot;:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([[1., 2., 3., 4.],</span>
<span class="sd">  ...                  [5., 6., 7., 8.],</span>
<span class="sd">  ...                  [9., 10., 11., 12.]])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [1, 3, 4, 1])</span>
<span class="sd">  &gt;&gt;&gt; max_pool_2d = tf.keras.layers.MaxPooling2D(pool_size=(2, 2),</span>
<span class="sd">  ...    strides=(1, 1), padding=&#39;valid&#39;)</span>
<span class="sd">  &gt;&gt;&gt; max_pool_2d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(1, 2, 3, 1), dtype=float32, numpy=</span>
<span class="sd">    array([[[[ 6.],</span>
<span class="sd">             [ 7.],</span>
<span class="sd">             [ 8.]],</span>
<span class="sd">            [[10.],</span>
<span class="sd">             [11.],</span>
<span class="sd">             [12.]]]], dtype=float32)&gt;</span>
<span class="sd">             </span>
<span class="sd">  Usage Example:</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; input_image = tf.constant([[[[1.], [1.], [2.], [4.]],</span>
<span class="sd">  ...                            [[2.], [2.], [3.], [2.]],</span>
<span class="sd">  ...                            [[4.], [1.], [1.], [1.]],</span>
<span class="sd">  ...                            [[2.], [2.], [1.], [4.]]]]) </span>
<span class="sd">  &gt;&gt;&gt; output = tf.constant([[[[1], [0]],</span>
<span class="sd">  ...                       [[0], [1]]]]) </span>
<span class="sd">  &gt;&gt;&gt; model = tf.keras.models.Sequential()</span>
<span class="sd">  &gt;&gt;&gt; model.add(tf.keras.layers.MaxPooling2D(pool_size=(2, 2), </span>
<span class="sd">  ...    input_shape=(4,4,1)))</span>
<span class="sd">  &gt;&gt;&gt; model.compile(&#39;adam&#39;, &#39;mean_squared_error&#39;)</span>
<span class="sd">  &gt;&gt;&gt; model.predict(input_image, steps=1)</span>
<span class="sd">  array([[[[2.],</span>
<span class="sd">           [4.]],</span>
<span class="sd">          [[4.],</span>
<span class="sd">           [4.]]]], dtype=float32)</span>

<span class="sd">  For example, for stride=(1,1) and padding=&quot;same&quot;:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([[1., 2., 3.],</span>
<span class="sd">  ...                  [4., 5., 6.],</span>
<span class="sd">  ...                  [7., 8., 9.]])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [1, 3, 3, 1])</span>
<span class="sd">  &gt;&gt;&gt; max_pool_2d = tf.keras.layers.MaxPooling2D(pool_size=(2, 2),</span>
<span class="sd">  ...    strides=(1, 1), padding=&#39;same&#39;)</span>
<span class="sd">  &gt;&gt;&gt; max_pool_2d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(1, 3, 3, 1), dtype=float32, numpy=</span>
<span class="sd">    array([[[[5.],</span>
<span class="sd">             [6.],</span>
<span class="sd">             [6.]],</span>
<span class="sd">            [[8.],</span>
<span class="sd">             [9.],</span>
<span class="sd">             [9.]],</span>
<span class="sd">            [[8.],</span>
<span class="sd">             [9.],</span>
<span class="sd">             [9.]]]], dtype=float32)&gt;</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_size: integer or tuple of 2 integers,</span>
<span class="sd">      window size over which to take the maximum.</span>
<span class="sd">      `(2, 2)` will take the max value over a 2x2 pooling window.</span>
<span class="sd">      If only one integer is specified, the same window length</span>
<span class="sd">      will be used for both dimensions.</span>
<span class="sd">    strides: Integer, tuple of 2 integers, or None.</span>
<span class="sd">      Strides values.  Specifies how far the pooling window moves</span>
<span class="sd">      for each pooling step. If None, it will default to `pool_size`.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">      &quot;valid&quot; adds no zero padding.  &quot;same&quot; adds padding such that if the stride</span>
<span class="sd">      is 1, the output shape is the same as input shape.</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, rows, cols, channels)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, channels, rows, cols)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, pooled_rows, pooled_cols, channels)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, channels, pooled_rows, pooled_cols)`.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tensor of rank 4 representing the maximum pooled values.  See above for</span>
<span class="sd">    output shape.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
               <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">max_pool</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span></div>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.AveragePooling2D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.AvgPool2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AveragePooling2D</span><span class="p">(</span><span class="n">Pooling2D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Average pooling operation for spatial data.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_size: integer or tuple of 2 integers,</span>
<span class="sd">      factors by which to downscale (vertical, horizontal).</span>
<span class="sd">      `(2, 2)` will halve the input in both spatial dimension.</span>
<span class="sd">      If only one integer is specified, the same window length</span>
<span class="sd">      will be used for both dimensions.</span>
<span class="sd">    strides: Integer, tuple of 2 integers, or None.</span>
<span class="sd">      Strides values.</span>
<span class="sd">      If None, it will default to `pool_size`.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, rows, cols, channels)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, channels, rows, cols)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, pooled_rows, pooled_cols, channels)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, channels, pooled_rows, pooled_cols)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
               <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">AveragePooling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">avg_pool</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Pooling3D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Pooling layer for arbitrary pooling functions, for 3D inputs.</span>

<span class="sd">  This class only exists for code reuse. It will never be an exposed API.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_function: The pooling function to apply, e.g. `tf.nn.max_pool2d`.</span>
<span class="sd">    pool_size: An integer or tuple/list of 3 integers:</span>
<span class="sd">      (pool_depth, pool_height, pool_width)</span>
<span class="sd">      specifying the size of the pooling window.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    strides: An integer or tuple/list of 3 integers,</span>
<span class="sd">      specifying the strides of the pooling operation.</span>
<span class="sd">      Can be a single integer to specify the same value for</span>
<span class="sd">      all spatial dimensions.</span>
<span class="sd">    padding: A string. The padding method, either &#39;valid&#39; or &#39;same&#39;.</span>
<span class="sd">      Case-insensitive.</span>
<span class="sd">    data_format: A string, one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, depth, height, width, channels)`</span>
<span class="sd">      while `channels_first` corresponds to</span>
<span class="sd">      inputs with shape `(batch, channels, depth, height, width)`.</span>
<span class="sd">    name: A string, the name of the layer.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_function</span><span class="p">,</span> <span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Pooling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">data_format</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">image_data_format</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">strides</span> <span class="o">=</span> <span class="n">pool_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pool_function</span> <span class="o">=</span> <span class="n">pool_function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">pool_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;pool_size&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_tuple</span><span class="p">(</span><span class="n">strides</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;strides&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_padding</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">pool_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
    <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="c1"># TF does not support `channels_first` with 3D pooling operations,</span>
      <span class="c1"># so we must handle this case manually.</span>
      <span class="c1"># TODO(fchollet): remove this when TF pooling is feature-complete.</span>
      <span class="n">inputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_function</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span>
        <span class="n">ksize</span><span class="o">=</span><span class="n">pool_shape</span><span class="p">,</span>
        <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">outputs</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="n">len_dim1</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">len_dim2</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">len_dim3</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">len_dim1</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">len_dim2</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">len_dim3</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">len_dim1</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">len_dim1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">len_dim2</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">len_dim2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">len_dim3</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">conv_output_length</span><span class="p">(</span><span class="n">len_dim3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">len_dim1</span><span class="p">,</span> <span class="n">len_dim2</span><span class="p">,</span> <span class="n">len_dim3</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span>
          <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">len_dim1</span><span class="p">,</span> <span class="n">len_dim2</span><span class="p">,</span> <span class="n">len_dim3</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pool_size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">,</span>
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span>
        <span class="s1">&#39;strides&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span><span class="p">,</span>
        <span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span>
    <span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Pooling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.MaxPool3D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.MaxPooling3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MaxPooling3D</span><span class="p">(</span><span class="n">Pooling3D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Max pooling operation for 3D data (spatial or spatio-temporal).</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_size: Tuple of 3 integers,</span>
<span class="sd">      factors by which to downscale (dim1, dim2, dim3).</span>
<span class="sd">      `(2, 2, 2)` will halve the size of the 3D input in each dimension.</span>
<span class="sd">    strides: tuple of 3 integers, or None. Strides values.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, pooled_dim1, pooled_dim2, pooled_dim3, channels)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, channels, pooled_dim1, pooled_dim2, pooled_dim3)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
               <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">MaxPooling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">max_pool3d</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.AveragePooling3D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.AvgPool3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AveragePooling3D</span><span class="p">(</span><span class="n">Pooling3D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Average pooling operation for 3D data (spatial or spatio-temporal).</span>

<span class="sd">  Arguments:</span>
<span class="sd">    pool_size: tuple of 3 integers,</span>
<span class="sd">      factors by which to downscale (dim1, dim2, dim3).</span>
<span class="sd">      `(2, 2, 2)` will halve the size of the 3D input in each dimension.</span>
<span class="sd">    strides: tuple of 3 integers, or None. Strides values.</span>
<span class="sd">    padding: One of `&quot;valid&quot;` or `&quot;same&quot;` (case-insensitive).</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, pooled_dim1, pooled_dim2, pooled_dim3, channels)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, channels, pooled_dim1, pooled_dim2, pooled_dim3)`</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
               <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span>
               <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">AveragePooling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">avg_pool3d</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="n">pool_size</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GlobalPooling1D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Abstract class for different global pooling 1D layers.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_first&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.GlobalAveragePooling1D&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.GlobalAvgPool1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlobalAveragePooling1D</span><span class="p">(</span><span class="n">GlobalPooling1D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Global average pooling operation for temporal data.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 3, 4)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.GlobalAveragePooling1D()(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (2, 4)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, steps, features)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, features, steps)`.</span>

<span class="sd">  Call arguments:</span>
<span class="sd">    inputs: A 3D tensor.</span>
<span class="sd">    mask: Binary tensor of shape `(batch_size, steps)` indicating whether</span>
<span class="sd">      a given step should be masked (excluded from the average).</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      3D tensor with shape:</span>
<span class="sd">      `(batch_size, steps, features)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      3D tensor with shape:</span>
<span class="sd">      `(batch_size, features, steps)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    2D tensor with shape `(batch_size, features)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;channels_last&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GlobalAveragePooling1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
                                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">supports_masking</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">steps_axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span> <span class="k">else</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">mask</span> <span class="o">=</span> <span class="n">math_ops</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">backend</span><span class="o">.</span><span class="n">floatx</span><span class="p">())</span>
      <span class="n">mask</span> <span class="o">=</span> <span class="n">array_ops</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
          <span class="n">mask</span><span class="p">,</span> <span class="mi">2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">inputs</span> <span class="o">*=</span> <span class="n">mask</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">steps_axis</span><span class="p">)</span> <span class="o">/</span> <span class="n">math_ops</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span>
          <span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">steps_axis</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">steps_axis</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.GlobalMaxPool1D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.GlobalMaxPooling1D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlobalMaxPooling1D</span><span class="p">(</span><span class="n">GlobalPooling1D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Global max pooling operation for 1D temporal data.</span>

<span class="sd">  Downsamples the input representation by taking the maximum value over</span>
<span class="sd">  the time dimension.</span>

<span class="sd">  For example:</span>

<span class="sd">  &gt;&gt;&gt; x = tf.constant([[1., 2., 3.], [4., 5., 6.], [7., 8., 9.]])</span>
<span class="sd">  &gt;&gt;&gt; x = tf.reshape(x, [3, 3, 1])</span>
<span class="sd">  &gt;&gt;&gt; x</span>
<span class="sd">  &lt;tf.Tensor: shape=(3, 3, 1), dtype=float32, numpy=</span>
<span class="sd">  array([[[1.], [2.], [3.]],</span>
<span class="sd">         [[4.], [5.], [6.]],</span>
<span class="sd">         [[7.], [8.], [9.]]], dtype=float32)&gt;</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d = tf.keras.layers.GlobalMaxPooling1D()</span>
<span class="sd">  &gt;&gt;&gt; max_pool_1d(x)</span>
<span class="sd">  &lt;tf.Tensor: shape=(3, 1), dtype=float32, numpy=</span>
<span class="sd">  array([[3.],</span>
<span class="sd">         [6.],</span>
<span class="sd">         [9.], dtype=float32)&gt;</span>

<span class="sd">  Arguments:</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, steps, features)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, features, steps)`.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      3D tensor with shape:</span>
<span class="sd">      `(batch_size, steps, features)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      3D tensor with shape:</span>
<span class="sd">      `(batch_size, features, steps)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    2D tensor with shape `(batch_size, features)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">steps_axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span> <span class="k">else</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">steps_axis</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GlobalPooling2D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Abstract class for different global pooling 2D layers.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPooling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPooling2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.GlobalAveragePooling2D&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.GlobalAvgPool2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlobalAveragePooling2D</span><span class="p">(</span><span class="n">GlobalPooling2D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Global average pooling operation for spatial data.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 4, 5, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.GlobalAveragePooling2D()(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (2, 3)</span>

<span class="sd">  Arguments:</span>
<span class="sd">      data_format: A string,</span>
<span class="sd">        one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">        The ordering of the dimensions in the inputs.</span>
<span class="sd">        `channels_last` corresponds to inputs with shape</span>
<span class="sd">        `(batch, height, width, channels)` while `channels_first`</span>
<span class="sd">        corresponds to inputs with shape</span>
<span class="sd">        `(batch, channels, height, width)`.</span>
<span class="sd">        It defaults to the `image_data_format` value found in your</span>
<span class="sd">        Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">        If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, rows, cols, channels)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, channels, rows, cols)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    2D tensor with shape `(batch_size, channels)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.GlobalMaxPool2D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.GlobalMaxPooling2D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlobalMaxPooling2D</span><span class="p">(</span><span class="n">GlobalPooling2D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Global max pooling operation for spatial data.</span>

<span class="sd">  Examples:</span>

<span class="sd">  &gt;&gt;&gt; input_shape = (2, 4, 5, 3)</span>
<span class="sd">  &gt;&gt;&gt; x = tf.random.normal(input_shape)</span>
<span class="sd">  &gt;&gt;&gt; y = tf.keras.layers.GlobalMaxPool2D()(x)</span>
<span class="sd">  &gt;&gt;&gt; print(y.shape)</span>
<span class="sd">  (2, 3)</span>

<span class="sd">  Arguments:</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, height, width, channels)` while `channels_first`</span>
<span class="sd">      corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, height, width)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, rows, cols, channels)`.</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      4D tensor with shape `(batch_size, channels, rows, cols)`.</span>

<span class="sd">  Output shape:</span>
<span class="sd">    2D tensor with shape `(batch_size, channels)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">GlobalPooling3D</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Abstract class for different global pooling 3D layers.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPooling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">conv_utils</span><span class="o">.</span><span class="n">normalize_data_format</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_spec</span> <span class="o">=</span> <span class="n">InputSpec</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">compute_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">tensor_shape</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

  <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="p">}</span>
    <span class="n">base_config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPooling3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.GlobalAveragePooling3D&#39;</span><span class="p">,</span>
              <span class="s1">&#39;keras.layers.GlobalAvgPool3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlobalAveragePooling3D</span><span class="p">(</span><span class="n">GlobalPooling3D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Global Average pooling operation for 3D data.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    2D tensor with shape `(batch_size, channels)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>


<span class="nd">@keras_export</span><span class="p">(</span><span class="s1">&#39;keras.layers.GlobalMaxPool3D&#39;</span><span class="p">,</span> <span class="s1">&#39;keras.layers.GlobalMaxPooling3D&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlobalMaxPooling3D</span><span class="p">(</span><span class="n">GlobalPooling3D</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Global Max pooling operation for 3D data.</span>

<span class="sd">  Arguments:</span>
<span class="sd">    data_format: A string,</span>
<span class="sd">      one of `channels_last` (default) or `channels_first`.</span>
<span class="sd">      The ordering of the dimensions in the inputs.</span>
<span class="sd">      `channels_last` corresponds to inputs with shape</span>
<span class="sd">      `(batch, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">      while `channels_first` corresponds to inputs with shape</span>
<span class="sd">      `(batch, channels, spatial_dim1, spatial_dim2, spatial_dim3)`.</span>
<span class="sd">      It defaults to the `image_data_format` value found in your</span>
<span class="sd">      Keras config file at `~/.keras/keras.json`.</span>
<span class="sd">      If you never set it, then it will be &quot;channels_last&quot;.</span>

<span class="sd">  Input shape:</span>
<span class="sd">    - If `data_format=&#39;channels_last&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, spatial_dim1, spatial_dim2, spatial_dim3, channels)`</span>
<span class="sd">    - If `data_format=&#39;channels_first&#39;`:</span>
<span class="sd">      5D tensor with shape:</span>
<span class="sd">      `(batch_size, channels, spatial_dim1, spatial_dim2, spatial_dim3)`</span>

<span class="sd">  Output shape:</span>
<span class="sd">    2D tensor with shape `(batch_size, channels)`.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s1">&#39;channels_last&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">backend</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>


<span class="c1"># Aliases</span>

<span class="n">AvgPool1D</span> <span class="o">=</span> <span class="n">AveragePooling1D</span>
<span class="n">MaxPool1D</span> <span class="o">=</span> <span class="n">MaxPooling1D</span>
<span class="n">AvgPool2D</span> <span class="o">=</span> <span class="n">AveragePooling2D</span>
<span class="n">MaxPool2D</span> <span class="o">=</span> <span class="n">MaxPooling2D</span>
<span class="n">AvgPool3D</span> <span class="o">=</span> <span class="n">AveragePooling3D</span>
<span class="n">MaxPool3D</span> <span class="o">=</span> <span class="n">MaxPooling3D</span>
<span class="n">GlobalMaxPool1D</span> <span class="o">=</span> <span class="n">GlobalMaxPooling1D</span>
<span class="n">GlobalMaxPool2D</span> <span class="o">=</span> <span class="n">GlobalMaxPooling2D</span>
<span class="n">GlobalMaxPool3D</span> <span class="o">=</span> <span class="n">GlobalMaxPooling3D</span>
<span class="n">GlobalAvgPool1D</span> <span class="o">=</span> <span class="n">GlobalAveragePooling1D</span>
<span class="n">GlobalAvgPool2D</span> <span class="o">=</span> <span class="n">GlobalAveragePooling2D</span>
<span class="n">GlobalAvgPool3D</span> <span class="o">=</span> <span class="n">GlobalAveragePooling3D</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2021, Arjun Desai.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>